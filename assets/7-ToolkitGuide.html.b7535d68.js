import{_ as a,r as s,o as r,c as d,a as e,b as n,e as o,d as i}from"./app.3ad1c1e4.js";const c={},l=o('<h1 id="apache-nifi-toolkit-guide" tabindex="-1"><a class="header-anchor" href="#apache-nifi-toolkit-guide" aria-hidden="true">#</a> Apache NiFi Toolkit Guide</h1><hr><p>\u7F16\u8F91\u4EBA:<strong><strong>\u9177\u9177\u7684\u8BDA</strong></strong> \u90AE\u7BB1:<strong>zhangchengk@foxmail.com</strong></p><hr><h2 id="overview" tabindex="-1"><a class="header-anchor" href="#overview" aria-hidden="true">#</a> Overview</h2><p>NiFi Toolkit\u5305\u542B\u51E0\u4E2A\u547D\u4EE4\u884C\u5B9E\u7528\u7A0B\u5E8F\uFF0C\u7528\u4E8E\u5728\u72EC\u7ACB\u548C\u7FA4\u96C6\u73AF\u5883\u4E2D\u8BBE\u7F6E\u548C\u652F\u6301NiFi\u3002\u8FD9\u4E9B\u5B9E\u7528\u7A0B\u5E8F\u5305\u62EC\uFF1A</p><ul><li><p>CLI\u2009\u2014\u2009<code>cli</code>\u5DE5\u5177\u53EF\u8BA9\u7BA1\u7406\u5458\u4E0ENiFi\u548CNiFi Registry\u5B9E\u4F8B\u8FDB\u884C\u4EA4\u4E92\uFF0C\u4EE5\u81EA\u52A8\u5316\u4EFB\u52A1\uFF0C\u4F8B\u5982\u90E8\u7F72\u7248\u672C\u5316\u6D41\u7A0B\uFF0C\u7BA1\u7406\u6D41\u7A0B\u7EC4\u548C\u96C6\u7FA4\u8282\u70B9\u3002</p></li><li><p>Encrypt Config\u2009\u2014\u2009<code>encrypt-config</code>\u5DE5\u5177\u4F1A\u52A0\u5BC6 <em>nifi.properties</em> \u6587\u4EF6\u4E2D\u7684\u654F\u611F\u5BC6\u94A5\uFF0C\u4EE5\u4FBF\u4E8E\u8BBE\u7F6E\u5B89\u5168\u7684NiFi\u5B9E\u4F8B\u3002</p></li><li><p>File Manager\u2009\u2014\u2009<code>file-manager</code>\u5DE5\u5177\u4F7F\u7BA1\u7406\u5458\u80FD\u591F\u4ECE\u5907\u4EFD\u4E2D\u5907\u4EFD\u3001\u5B89\u88C5\u6216\u8FD8\u539FNiFi\u5B89\u88C5\u3002</p></li><li><p>Flow Analyzer\u2009\u2014\u2009<code>flow-analyzer</code>\u5DE5\u5177\u4F1A\u751F\u6210\u4E00\u4E2A\u62A5\u544A\uFF0C\u53EF\u5E2E\u52A9\u7BA1\u7406\u5458\u4E86\u89E3\u6307\u5B9A\u6D41\u7A0B\u53EF\u4EE5\u5B58\u50A8\u5728\u80CC\u538B\u4E2D\u7684\u6700\u5927\u6570\u636E\u91CF\u3002</p></li><li><p>Node Manager\u2009\u2014\u2009<code>node-manager</code>\u5DE5\u5177\u4F7F\u7BA1\u7406\u5458\u80FD\u591F\u5BF9\u8282\u70B9\u6267\u884C\u72B6\u6001\u68C0\u67E5\uFF0C\u5E76\u5177\u6709\u4ECE\u96C6\u7FA4\u8FDE\u63A5\uFF0C\u65AD\u5F00\u8FDE\u63A5\u6216\u4ECE\u4E2D\u5220\u9664\u8282\u70B9\u7684\u80FD\u529B\u3002</p></li><li><p>Notify\u2009\u2014\u2009<code>notify</code>\u5DE5\u5177\u4F7F\u7BA1\u7406\u5458\u80FD\u591F\u5C06\u516C\u544A\u53D1\u9001\u5230NiFi UI\u3002</p></li><li><p>S2S\u2009\u2014\u2009<code>s2s</code>\u5DE5\u5177\u4F7F\u7BA1\u7406\u5458\u53EF\u4EE5\u901A\u8FC7site-to-site\u5411NiFi\u6D41\u53D1\u9001\u6570\u636E\u6216\u4ECENiFi\u6D41\u53D1\u9001\u6570\u636E\u3002</p></li><li><p>TLS Toolkit\u2009\u2014\u2009<code>tls-toolkit</code>\u4F1A\u751F\u6210\u6240\u9700\u7684\u5BC6\u94A5\u5E93\uFF0C\u4FE1\u4EFB\u5E93\u548C\u76F8\u5173\u7684\u914D\u7F6E\u6587\u4EF6\uFF0C\u4EE5\u7B80\u5316\u5B89\u5168NiFi\u5B9E\u4F8B\u7684\u8BBE\u7F6E\u3002</p></li><li><p>ZooKeeper Migrator\u2009\u2014\u2009<code>zk-migrator</code>\u5DE5\u5177\u4F7F\u7BA1\u7406\u5458\u80FD\u591F\uFF1A</p><ul><li><p>\u5C06ZooKeeper\u4FE1\u606F\u4ECE\u4E00\u4E2AZooKeeper\u96C6\u7FA4\u79FB\u52A8\u5230\u53E6\u4E00\u4E2A\u96C6\u7FA4</p></li><li><p>\u8FC1\u79FBZooKeeper\u8282\u70B9\u6240\u6709\u6743</p></li></ul></li></ul><p>\u8FD9\u4E9B\u5B9E\u7528\u7A0B\u5E8F\u5C06\u901A\u8FC7NiFi Toolkit\u5B89\u88C5\u76EE\u5F55\u7684<code>bin</code>\u6587\u4EF6\u5939\u4E2D\u7684\u811A\u672C\u6267\u884C\u3002</p>',8),p=i("\u6CE8\u610F\uFF1ANiFi Toolkit\u662F\u4ECENiFi\u5355\u72EC\u4E0B\u8F7D\u7684 (see the "),u={href:"https://nifi.apache.org/download.html",target:"_blank",rel:"noopener noreferrer"},h=i("Apache NiFi Downloads"),f=i(" page)."),m=o(`<h3 id="prerequisites-for-running-in-a-secure-environment" tabindex="-1"><a class="header-anchor" href="#prerequisites-for-running-in-a-secure-environment" aria-hidden="true">#</a> Prerequisites for Running in a Secure Environment</h3><p>\u5BF9\u4E8E\u53D7\u4FDD\u62A4\u7684\u8282\u70B9\u548C\u7FA4\u96C6\uFF0C\u5E94\u9884\u5148\u914D\u7F6E\u4E24\u4E2A\u7B56\u7565\uFF1A</p><ul><li><p>Access the controller \u2013 \u901A\u8FC7\u521B\u5EFA\u5177\u6709\u67E5\u770B\u548C\u4FEE\u6539\u6743\u9650\u7684\u201Caccess the controller\u201D\u7B56\u7565(<code>/controller</code>)\uFF0C\u53EF\u4EE5\u5728NiFi\u4E2D\u6388\u6743\u6709\u6743\u8BBF\u95EE\u8FD9\u4E9B\u5B9E\u7528\u7A0B\u5E8F\u7684\u7528\u6237\u3002</p></li><li><p>Proxy user request \u2013 \u5982\u679C\u4EE5\u524D\u672A\u8BBE\u7F6E\uFF0C\u5219\u5E94\u6388\u6743\u8282\u70B9\u7684\u8EAB\u4EFD(\u8282\u70B9\u8BC1\u4E66\u7684DN\u503C)\u4EE3\u8868\u7528\u6237\u4EE3\u7406\u8BF7\u6C42</p></li></ul><p>\u5728\u5B89\u5168\u73AF\u5883\u4E2D\u6267\u884CNotify\u6216Node Manager\u5DE5\u5177\u65F6\uFF0C\u5E94\u4F7F\u7528<code>proxyDN</code>\u6807\u5FD7\u9009\u9879\uFF0C\u4EE5\u6B63\u786E\u8BC6\u522B\u88AB\u6388\u6743\u6267\u884C\u8FD9\u4E9B\u547D\u4EE4\u7684\u7528\u6237\u3002\u5728\u975E\u5B89\u5168\u73AF\u5883\u4E2D\uFF0C\u6216\u8005\u5982\u679C\u5728\u8282\u70B9\u7BA1\u7406\u5668\u5DE5\u5177\u4E0A\u8FD0\u884C\u72B6\u6001\u64CD\u4F5C\uFF0C\u5219\u5FFD\u7565\u8BE5\u6807\u5FD7\u3002</p><h2 id="nifi-cli" tabindex="-1"><a class="header-anchor" href="#nifi-cli" aria-hidden="true">#</a> NiFi CLI</h2><p>\u8BE5\u5DE5\u5177\u63D0\u4F9B\u4E86\u4E00\u4E2ACLI\uFF0C\u8BE5CLI\u4E13\u6CE8\u4E8E\u4E0ENiFi\u548CNiFi Registry\u8FDB\u884C\u4EA4\u4E92\u4EE5\u81EA\u52A8\u5316\u4EFB\u52A1\uFF0C\u4F8B\u5982\u5C06\u6D41\u4ECENIFi Registy\u90E8\u7F72\u5230NiFi\u5B9E\u4F8B\u6216\u7BA1\u7406\u6D41\u7A0B\u7EC4\u548C\u96C6\u7FA4\u8282\u70B9\u3002</p><h3 id="usage" tabindex="-1"><a class="header-anchor" href="#usage" aria-hidden="true">#</a> Usage</h3><p>CLI\u5DE5\u5177\u5305\u53EF\u4EE5\u5728\u72EC\u7ACB\u6A21\u5F0F\u4E0B\u6267\u884C\u4EE5\u6267\u884C\u5355\u4E2A\u547D\u4EE4\uFF0C\u4E5F\u53EF\u4EE5\u5728\u4EA4\u4E92\u6A21\u5F0F\u4E0B\u6267\u884C\u4EE5\u8FDB\u5165\u4EA4\u4E92\u5F0F\u5916\u58F3\u3002</p><p>\u8981\u6267\u884C\u5355\u4E2A\u547D\u4EE4\uFF1A</p><pre>./bin/cli.sh command args
</pre><p>\u8981\u542F\u52A8\u4EA4\u4E92\u5F0Fshell\uFF1A</p><pre>./bin/cli.sh
</pre><p>\u8981\u663E\u793A\u5E2E\u52A9\uFF1A</p><pre>./bin/cli.sh -h
</pre><p>\u4EE5\u4E0B\u662F\u53EF\u7528\u7684\u547D\u4EE4\uFF1A</p><pre>demo quick-import
nifi current-user
nifi cluster-summary
nifi connect-node
nifi delete-node
nifi disconnect-node
nifi get-root-id
nifi get-node
nifi get-nodes
nifi offload-node
nifi list-reg-clients
nifi create-reg-client
nifi update-reg-client
nifi get-reg-client-id
nifi pg-import
nifi pg-start
nifi pg-stop
nifi pg-get-vars
nifi pg-set-var
nifi pg-get-version
nifi pg-change-version
nifi pg-get-all-versions
nifi pg-list
nifi pg-status
nifi pg-get-services
nifi pg-enable-services
nifi pg-disable-services
nifi pg-create-service
nifi create-user
nifi list-users
nifi create-user-group
nifi list-user-groups
nifi update-user-group
nifi get-policy
nifi update-policy
nifi create-service
nifi get-services
nifi get-service
nifi disable-services
nifi enable-services
nifi get-reporting-task
nifi get-reporting-tasks
nifi create-reporting-task
nifi set-param
nifi delete-param
nifi list-param-contexts
nifi get-param-context
nifi create-param-context
nifi delete-param-context
nifi merge-param-context
nifi import-param-context
nifi pg-get-param-context
nifi pg-set-param-context
nifi list-templates
nifi download-template
nifi upload-template
nifi start-reporting-tasks
nifi stop-reporting-tasks
registry current-user
registry list-buckets
registry create-bucket
registry delete-bucket
registry list-flows
registry create-flow
registry delete-flow
registry list-flow-versions
registry export-flow-version
registry import-flow-version
registry sync-flow-versions
registry transfer-flow-version
registry diff-flow-versions
registry upload-bundle
registry upload-bundles
registry list-bundle-groups
registry list-bundle-artifacts
registry list-bundle-versions
registry download-bundle
registry get-bundle-checksum
registry list-extension-tags
registry list-extensions
registry list-users
registry create-user
registry update-user
registry list-user-groups
registry create-user-group
registry update-user-group
registry get-policy
registry update-policy
registry update-bucket-policy
session keys
session show
session get
session set
session remove
session clear
exit
help
</pre><p>\u8981\u663E\u793A\u7279\u5B9A\u547D\u4EE4\u7684\u5E7F\u6CDB\u5E2E\u52A9\uFF1A</p><pre>./bin/cli.sh command -h
</pre><h3 id="property-argument-handling" tabindex="-1"><a class="header-anchor" href="#property-argument-handling" aria-hidden="true">#</a> Property/Argument Handling</h3><p>\u5927\u591A\u6570\u547D\u4EE4\u90FD\u9700\u8981\u4E3ANiFi\u6216NiFi Registry\u5B9E\u4F8B\u6307\u5B9AbaseUrl\u3002</p><p>\u5728NiFi Registry\u5B9E\u4F8B\u4E2D\u5217\u51FA\u5B58\u50A8\u6876\u7684\u793A\u4F8B\u547D\u4EE4\u5982\u4E0B\uFF1A</p><pre>./bin/cli.sh registry list-buckets -u http://localhost:18080
</pre><p>\u4E3A\u4E86\u907F\u514D\u5728\u6BCF\u4E2A\u547D\u4EE4\u4E0A\u6307\u5B9AURL(\u4EE5\u53CA\u53EF\u80FD\u7684TLS\u5176\u4ED6\u53EF\u9009\u53C2\u6570)\uFF0C\u53EF\u4EE5\u5B9A\u4E49\u4E00\u4E2A\u5305\u542B\u91CD\u590D\u53C2\u6570\u7684\u5C5E\u6027\u6587\u4EF6\u3002</p><p>\u672C\u5730NiFi Registry\u5B9E\u4F8B\u7684\u793A\u4F8B\u5C5E\u6027\u6587\u4EF6\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code> baseUrl=http://localhost:18080
 keystore=
 keystoreType=
 keystorePasswd=
 keyPasswd=
 truststore=
 truststoreType=
 truststorePasswd=
 proxiedEntity=
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7136\u540E\u901A\u8FC7\u6307\u5B9A<code>-p</code>\u53EF\u4EE5\u5728\u547D\u4EE4\u4E0A\u4F7F\u7528\u8BE5\u5C5E\u6027\u6587\u4EF6\uFF1A</p><pre>./bin/cli.sh registry list-buckets -p /path/to/local-nifi-registry.properties
</pre><p>\u7136\u540E\uFF0C\u60A8\u53EF\u4EE5\u4E3A\u8BA1\u5212\u4E0E\u4E4B\u4EA4\u4E92\u7684\u6BCF\u4E2A\u73AF\u5883\u7EF4\u62A4\u4E00\u4E2A\u5C5E\u6027\u6587\u4EF6\uFF0C\u4F8B\u5982Dev\uFF0CQA\u548CProd\u3002</p><p>\u9664\u4E86\u5728\u6BCF\u4E2A\u547D\u4EE4\u4E0A\u6307\u5B9A\u5C5E\u6027\u6587\u4EF6\u4E4B\u5916\uFF0C\u60A8\u8FD8\u53EF\u4EE5\u8BBE\u7F6E\u9ED8\u8BA4\u5C5E\u6027\u6587\u4EF6\uFF0C\u4EE5\u5728\u672A\u6307\u5B9A\u5C5E\u6027\u6587\u4EF6\u7684\u60C5\u51B5\u4E0B\u4F7F\u7528\u3002</p><p>\u9ED8\u8BA4\u5C5E\u6027\u6587\u4EF6\u662F\u4F7F\u7528<code>session</code>\u6982\u5FF5\u6307\u5B9A\u7684\uFF0C\u8BE5\u6982\u5FF5\u5728\u540D\u4E3A <em>.nifi-cli.config</em> \u7684\u6587\u4EF6\u4E2D\u4FDD\u7559\u5728\u7528\u6237\u7684\u4E3B\u76EE\u5F55\u4E2D\u3002 \u4E3ANiFi\u8BBE\u7F6E\u9ED8\u8BA4\u5C5E\u6027\u6587\u4EF6\u7684\u793A\u4F8B\u5982\u4E0B\uFF1A</p><pre>./bin/cli.sh session set nifi.props /path/to/local-nifi.properties
</pre><p>NiFi Registry\u7684\u793A\u4F8B\u5982\u4E0B\uFF1A</p><pre>./bin/cli.sh session set nifi.reg.props /path/to/local-nifi-registry.properties
</pre><p>\u8FD9\u4F1A\u5C06\u4E0A\u8FF0\u5C5E\u6027\u5199\u5165\u7528\u6237\u4E3B\u76EE\u5F55\u4E2D\u7684 <em>.nifi-cli.config</em> \u4E2D\uFF0C\u5E76\u5141\u8BB8\u5728\u4E0D\u6307\u5B9AURL\u6216\u5C5E\u6027\u6587\u4EF6\u7684\u60C5\u51B5\u4E0B\u6267\u884C\u547D\u4EE4\uFF1A</p><pre>./bin/cli.sh registry list-buckets
</pre><p>\u4E0A\u9762\u7684\u547D\u4EE4\u73B0\u5728\u5C06\u4F7F\u7528 <em>local-nifi-registry.properties</em> \u4E2D\u7684<code>baseUrl</code>\u3002</p><p>\u89E3\u51B3\u53C2\u6570\u7684\u987A\u5E8F\u5982\u4E0B\uFF1A</p><ul><li><p>\u76F4\u63A5\u53C2\u6570\u4F1A\u8986\u76D6\u5C5E\u6027\u6587\u4EF6\u6216\u4F1A\u8BDD\u4E2D\u7684\u6240\u6709\u5185\u5BB9</p></li><li><p>\u5C5E\u6027\u6587\u4EF6\u53C2\u6570(-p)\u8986\u76D6\u4F1A\u8BDD</p></li><li><p>\u5982\u679C\u672A\u6307\u5B9A\u5176\u4ED6\u4EFB\u4F55\u5185\u5BB9\uFF0C\u5219\u4F7F\u7528\u8BE5\u4F1A\u8BDD</p></li></ul><h3 id="security-configuration" tabindex="-1"><a class="header-anchor" href="#security-configuration" aria-hidden="true">#</a> Security Configuration</h3><p>\u5982\u679CNiFi\u548CNiFi\u6CE8\u518C\u8868\u53D7\u5230\u4FDD\u62A4\uFF0C\u5219\u4ECECLI\u6267\u884C\u7684\u547D\u4EE4\u5C06\u9700\u8981\u5EFA\u7ACBTLS\u8FDE\u63A5\u5E76\u4EE5\u5177\u6709\u6267\u884C\u6240\u9700\u64CD\u4F5C\u6743\u9650\u7684\u7528\u6237\u8EAB\u4EFD\u8FDB\u884C\u8EAB\u4EFD\u9A8C\u8BC1\u3002</p><p>\u5F53\u524D\uFF0CCLI\u652F\u6301\u4F7F\u7528\u5BA2\u6237\u7AEF\u8BC1\u4E66\u548C\u53EF\u9009\u7684\u4EE3\u7406\u5B9E\u4F53\u8FDB\u884C\u8EAB\u4EFD\u9A8C\u8BC1\u3002\u4E00\u79CD\u5E38\u89C1\u7684\u60C5\u51B5\u662F\u4ECE\u5B89\u88C5NiFi\u6216NiFi Registry\u7684\u8282\u70B9\u4E4B\u4E00\u8FD0\u884CCLI\uFF0C\u8FD9\u4F7FCLI\u53EF\u4EE5\u4F7F\u7528\u4E0ENiFi/NiFi Registry\u5B9E\u4F8B\u76F8\u540C\u7684\u5BC6\u94A5\u5E93\u548C\u4FE1\u4EFB\u5E93\u3002</p><p>\u53EF\u4EE5\u6309\u547D\u4EE4\u6216\u5728\u4E0A\u4E00\u8282\u4E2D\u63CF\u8FF0\u7684\u5C5E\u6027\u6587\u4EF6\u4E4B\u4E00\u4E2D\u6307\u5B9A\u5B89\u5168\u6027\u914D\u7F6E\u3002</p><p>\u4EE5\u4E0B\u793A\u4F8B\u9002\u7528\u4E8ENiFi Registry\uFF0C\u4F46\u76F8\u540C\u7684\u6982\u5FF5\u9002\u7528\u4E8ENiFi\u547D\u4EE4\u3002</p><h4 id="example-secure-nifi-registry-without-proxied-entity" tabindex="-1"><a class="header-anchor" href="#example-secure-nifi-registry-without-proxied-entity" aria-hidden="true">#</a> Example - Secure NiFi Registry without Proxied-Entity</h4><p>\u5047\u8BBE\u6211\u4EEC\u6709\u4E00\u4E2A\u5305\u542B&quot;CN=user1, OU=NIFI&quot;\u8BC1\u4E66\u7684\u5BC6\u94A5\u5E93\uFF0C\u5219\u793A\u4F8B\u5C5E\u6027\u6587\u4EF6\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>baseUrl=https://localhost:18443
 keystore=/path/to/keystore.jks
 keystoreType=JKS
 keystorePasswd=changeme
 keyPasswd=changeme
 truststore=/path/to/truststore.jks
 truststoreType=JKS
 truststorePasswd=changeme
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728\u6B64\u793A\u4F8B\u4E2D\uFF0C\u547D\u4EE4\u5C06\u4EE5&quot;CN=user1, OU=NIFI&quot;\u6267\u884C\u3002\u8BE5\u7528\u6237\u5FC5\u987B\u662FNiFi Registry\u4E2D\u7684\u7528\u6237\uFF0C\u5E76\u4E14\u8BBF\u95EE\u5B58\u50A8\u6876\u7684\u547D\u4EE4\u5C06\u4EC5\u9650\u4E8E\u8BE5\u7528\u6237\u6709\u6743\u8BBF\u95EE\u7684\u5B58\u50A8\u6876\u3002</p><h4 id="example-secure-nifi-registry-with-proxied-entity" tabindex="-1"><a class="header-anchor" href="#example-secure-nifi-registry-with-proxied-entity" aria-hidden="true">#</a> Example - Secure NiFi Registry with Proxied-Entity</h4><p>\u5047\u8BBE\u6211\u4EEC\u53EF\u4EE5\u8BBF\u95EENiFi Registry\u672C\u8EAB\u7684\u5BC6\u94A5\u5E93\uFF0C\u5E76\u4E14NiFi Registry\u4E5F\u914D\u7F6E\u4E3A\u5141\u8BB8Kerberos\u6216LDAP\u8EAB\u4EFD\u9A8C\u8BC1\uFF0C\u5219\u793A\u4F8B\u5C5E\u6027\u6587\u4EF6\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>baseUrl=https://localhost:18443
 keystore=/path/to/keystore.jks
 keystoreType=JKS
 keystorePasswd=changeme
 keyPasswd=changeme
 truststore=/path/to/truststore.jks
 truststoreType=JKS
 truststorePasswd=changeme
 proxiedEntity=user1@NIFI.COM
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728\u6B64\u793A\u4F8B\u4E2D\uFF0C<em>keystore.jks</em> \u4E2D\u7684\u8BC1\u4E66\u5C06\u7528\u4E8ENiFi Registry\u670D\u52A1\u5668\uFF0C\u4F8B\u5982&quot;CN=localhost, OU=NIFI&quot;\u3002\u8BE5\u8EAB\u4EFD\u9700\u8981\u5728NiFi Registry\u4E2D\u5B9A\u4E49\u4E3A\u7528\u6237\uFF0C\u5E76\u5177\u6709\u201CProxy\u201D\u7684\u6743\u9650\u3002</p><p>&quot;CN=localhost, OU=NIFI&quot; \u5C06\u4F5C\u4E3A\u8981\u4EE5<a href="mailto%EF%BC%9Auser1@NIFI.COM">user1@NIFI.COM</a>\u6267\u884C\u7684\u4EE3\u7406\u547D\u4EE4\u3002</p><h3 id="nteractive-usage" tabindex="-1"><a class="header-anchor" href="#nteractive-usage" aria-hidden="true">#</a> nteractive Usage</h3><p>\u5728\u4EA4\u4E92\u6A21\u5F0F\u4E0B\uFF0CTab\u952E\u53EF\u7528\u4E8E\u6267\u884C\u81EA\u52A8\u5B8C\u6210\u3002 \u4F8B\u5982\uFF0C\u5728\u7A7A\u63D0\u793A\u4E0B\u952E\u5165tab\u5E94\u8BE5\u663E\u793A\u7B2C\u4E00\u4E2A\u53C2\u6570\u7684\u53EF\u80FD\u547D\u4EE4\uFF1A</p><pre>#&gt;
demo       exit       help       nifi       registry   session
</pre><p>\u952E\u5165\u201Cnifi \u201D\uFF0C\u7136\u540ETab\u952E\u5C06\u663E\u793ANiFi\u7684\u5B50\u547D\u4EE4\uFF1A</p><pre>#&gt; nifi
cluster-summary         enable-services         list-templates          pg-list
connect-node            export-param-context    list-user-groups        pg-set-param-context
create-param-context    get-node                list-users              pg-set-var
create-reg-client       get-nodes               merge-param-context     pg-start
create-reporting-task   get-param-context       offload-node            pg-status
create-service          get-policy              pg-change-version       pg-stop
create-user             get-reg-client-id       pg-create-service       set-param
create-user-group       get-reporting-task      pg-disable-services     start-reporting-tasks
current-user            get-reporting-tasks     pg-enable-services      stop-reporting-tasks
delete-node             get-root-id             pg-get-all-versions     update-policy
delete-param            get-service             pg-get-param-context    update-reg-client
delete-param-context    get-services            pg-get-services         update-user-group
disable-services        import-param-context    pg-get-vars             upload-template
disconnect-node         list-param-contexts     pg-get-version
download-template       list-reg-clients        pg-import
</pre><p>\u4EE3\u8868\u6587\u4EF6\u8DEF\u5F84\u7684\u53C2\u6570(\u4F8B\u5982-p\u6216\u5728\u4F1A\u8BDD\u4E2D\u8BBE\u7F6E\u5C5E\u6027\u6587\u4EF6\u65F6)\u5C06\u81EA\u52A8\u5B8C\u6210\u6240\u952E\u5165\u7684\u8DEF\u5F84\uFF1A</p><pre>#&gt; session set nifi.props /tmp/
dir1/   dir2/   dir3/
</pre><h3 id="output" tabindex="-1"><a class="header-anchor" href="#output" aria-hidden="true">#</a> Output</h3><p>\u5927\u591A\u6570\u547D\u4EE4\u90FD\u652F\u6301\u6307\u5B9A<code>--outputType</code>\u53C2\u6570\u6216\u7B80\u79F0\u4E3A<code>-ot</code>\u7684\u529F\u80FD\u3002 \u5F53\u524D\uFF0C\u8F93\u51FA\u7C7B\u578B\u53EF\u80FD\u662Fsimple\u6216json\u3002</p><p>\u4EA4\u4E92\u6A21\u5F0F\u4E0B\u7684\u9ED8\u8BA4\u8F93\u51FA\u7C7B\u578B\u5F88\u7B80\u5355\uFF0C\u800C\u72EC\u7ACB\u6A21\u5F0F\u4E0B\u7684\u9ED8\u8BA4\u8F93\u51FA\u7C7B\u578B\u662Fjson\u3002 <code>list-buckets</code>\u7684\u7B80\u5355\u8F93\u51FA\u793A\u4F8B\uFF1A</p><pre>#&gt; registry list-buckets -ot simple
My Bucket - 3c7b7467-0012-4d8f-a918-6aa42b6b9d39
</pre><p>list-buckets\u7684json\u8F93\u51FA\u793A\u4F8B\uFF1A</p><pre>#&gt; registry list-buckets -ot json
[ {
  &quot;identifier&quot; : &quot;3c7b7467-0012-4d8f-a918-6aa42b6b9d39&quot;,
  &quot;name&quot; : &quot;My Bucket&quot;,
  &quot;createdTimestamp&quot; : 1516718733854,
  &quot;permissions&quot; : {
    &quot;canRead&quot; : true,
    &quot;canWrite&quot; : true,
    &quot;canDelete&quot; : true
  },
  &quot;link&quot; : {
    &quot;params&quot; : {
      &quot;rel&quot; : &quot;self&quot;
    },
    &quot;href&quot; : &quot;buckets/3c7b7467-0012-4d8f-a918-6aa42b6b9d39&quot;
  }
} ]
</pre><h3 id="back-referencing" tabindex="-1"><a class="header-anchor" href="#back-referencing" aria-hidden="true">#</a> Back-Referencing</h3><p>\u4F7F\u7528\u4EA4\u4E92\u5F0FCLI\u65F6\uFF0C\u5E38\u89C1\u7684\u60C5\u51B5\u662F\u5C06\u4E0A\u4E00\u4E2A\u7ED3\u679C\u4E2D\u7684id\u7528\u4F5C\u4E0B\u4E00\u4E2A\u547D\u4EE4\u7684\u8F93\u5165\u3002\u53CD\u5411\u5F15\u7528\u63D0\u4F9B\u4E86\u4E00\u79CD\u5FEB\u6377\u65B9\u5F0F\uFF0C\u7528\u4E8E\u901A\u8FC7\u4F4D\u7F6E\u5F15\u7528\u6765\u5F15\u7528\u5148\u524D\u547D\u4EE4\u7684\u7ED3\u679C\u3002</p><table><thead><tr><th>col 1</th><th>col 2</th></tr></thead><tbody><tr><td>__</td><td>Not every command produces back-references. To determine if a command supports back-referencing, check the usage.</td></tr></tbody></table><pre>#&gt; registry list-buckets help
Lists the buckets that the current user has access to.
PRODUCES BACK-REFERENCES
</pre><p>\u5229\u7528\u53CD\u5411\u5F15\u7528\u7684\u5E38\u89C1\u60C5\u51B5\u5982\u4E0B\uFF1A</p><ol><li><p>\u7528\u6237\u9996\u5148\u6D4F\u89C8\u6CE8\u518C\u8868\u5B9E\u4F8B\u4E2D\u7684\u53EF\u7528\u5B58\u50A8\u6876</p><pre>#&gt; registry list-buckets
#   Name           Id                                     Description
-   ------------   ------------------------------------   -----------
1   My Bucket      3c7b7467-0012-4d8f-a918-6aa42b6b9d39   (empty)
2   Other Bucket   175fb557-43a2-4abb-871f-81a354f47bc2   (empty)
</pre></li><li><p>\u7136\u540E\uFF0C\u7528\u6237\u4F7F\u7528\u4F4D\u7F6E1\u4E2D\u5148\u524D\u7ED3\u679C\u7684\u5B58\u50A8\u6876ID\u7684\u5411\u540E\u5F15\u7528\uFF0C\u67E5\u770B\u5176\u4E2D\u4E00\u4E2A\u5B58\u50A8\u6876\u4E2D\u7684\u6D41</p><pre>#&gt; registry list-flows -b &amp;1
Using a positional back-reference for &#39;My Bucket&#39;
#   Name      Id                                     Description
-   -------   ------------------------------------   ----------------
1   My Flow   06acb207-d2f1-447f-85ed-9b8672fe6d30   This is my flow.
</pre></li><li><p>\u7136\u540E\uFF0C\u7528\u6237\u4F7F\u7528\u5BF9\u4F4D\u7F6E1\u4E2D\u5148\u524D\u7ED3\u679C\u7684\u6D41ID\u7684\u53CD\u5411\u5F15\u7528\u6765\u67E5\u770B\u6D41\u7684\u7248\u672C</p><pre>#&gt; registry list-flow-versions -f &amp;1
Using a positional back-reference for &#39;My Flow&#39;
Ver   Date                         Author                     Message
---   --------------------------   ------------------------   -------------------------------------
1     Tue, Jan 23 2018 09:48 EST   anonymous                  This is the first version of my flow.
</pre></li><li><p>\u7528\u6237\u4F7F\u7528\u5BF9\u5B58\u50A8\u6876\u7684\u53CD\u5411\u5F15\u7528\u548C\u6B65\u9AA42\u4E2D\u7684\u6D41ID\u90E8\u7F72\u6D41\u7684\u7248\u672C1</p><pre>#&gt; nifi pg-import -b &amp;1 -f &amp;1 -fv 1
Using a positional back-reference for &#39;My Bucket&#39;
Using a positional back-reference for &#39;My Flow&#39;
9bd157d4-0161-1000-b946-c1f9b1832efd
</pre></li></ol><p>\u6B65\u9AA44\u4E4B\u6240\u4EE5\u80FD\u591F\u5F15\u7528\u6B65\u9AA42\u7684\u7ED3\u679C\uFF0C\u662F\u56E0\u4E3A\u6B65\u9AA43\u4E2D\u7684<code>list-flow-versions</code>\u547D\u4EE4\u4E0D\u4F1A\u4EA7\u751F\u53CD\u5411\u5F15\u7528\uFF0C\u56E0\u6B64\u6B65\u9AA42\u7684\u7ED3\u679C\u4ECD\u7136\u53EF\u7528\u3002</p><h3 id="adding-commands" tabindex="-1"><a class="header-anchor" href="#adding-commands" aria-hidden="true">#</a> Adding Commands</h3><p>\u8981\u6DFB\u52A0NiFi\u547D\u4EE4\uFF0C\u8BF7\u521B\u5EFA\u6269\u5C55<code>AbstractNiFiCommand</code>\u7684\u65B0\u7C7B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyCommand</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractNiFiCommand</span> <span class="token punctuation">{</span>

  <span class="token keyword">public</span> <span class="token class-name">MyCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token string">&quot;my-command&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doExecute</span><span class="token punctuation">(</span><span class="token class-name">NiFiClient</span> client<span class="token punctuation">,</span> <span class="token class-name">Properties</span> properties<span class="token punctuation">)</span>
          <span class="token keyword">throws</span> <span class="token class-name">NiFiClientException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">MissingOptionException</span><span class="token punctuation">,</span> <span class="token class-name">CommandException</span> <span class="token punctuation">{</span>
      <span class="token comment">// TODO implement</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">&quot;This is my new command&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5C06\u65B0\u547D\u4EE4\u6DFB\u52A0\u5230<code>NiFiCommandGroup</code>\u4E2D\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>commands<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u8981\u6DFB\u52A0NiFi Registry\u547D\u4EE4\uFF0C\u8BF7\u6267\u884C\u76F8\u540C\u7684\u6B65\u9AA4\uFF0C\u4F46\u8981\u4ECE<code>AbstractNiFiRegistryCommand</code>\u6269\u5C55\uFF0C\u7136\u540E\u5C06\u547D\u4EE4\u6DFB\u52A0\u81F3<code>NiFiRegistryCommandGroup</code>\u3002</p><h2 id="encrypt-config-tool" tabindex="-1"><a class="header-anchor" href="#encrypt-config-tool" aria-hidden="true">#</a> Encrypt-Config Tool</h2><p><code>encrypt-config</code>\u547D\u4EE4\u884C\u5DE5\u5177(\u79F0\u4E3A<code>./bin/encrypt-config.sh</code>\u6216<code>bin\\encrypt-config.bat</code>)\u4ECE\u5177\u6709\u660E\u6587\u654F\u611F\u914D\u7F6E\u503C\u7684 <em>nifi.properties</em> \u6587\u4EF6\u4E2D\u8BFB\u53D6\uFF0C\u63D0\u793A\u8F93\u5165root\u5BC6\u7801\u6216\u539F\u59CB\u5341\u516D\u8FDB\u5236\u5BC6\u94A5\uFF0C\u5E76\u52A0\u5BC6\u6BCF\u4E2A\u503C\u3002\u5B83\u5C06\u539F\u59CB\u503C\u66FF\u6362\u4E3A\u540C\u4E00\u6587\u4EF6\u4E2D\u7684\u53D7\u4FDD\u62A4\u503C\uFF0C\u6216\u8005\u5982\u679C\u6307\u5B9A\uFF0C\u5219\u5199\u5165\u65B0\u7684 <em>nifi.properties</em> \u6587\u4EF6\u3002</p><p>\u4F7F\u7528\u7684\u9ED8\u8BA4\u52A0\u5BC6\u7B97\u6CD5\u662FAES/GCM128/256\u4F4D\u3002\u5982\u679C\u672A\u5B89\u88C5JCE\u65E0\u9650\u5F3A\u5EA6\u52A0\u5BC6\u7BA1\u8F96\u533A\u7B56\u7565\u6587\u4EF6\uFF0C\u5219\u4F7F\u7528128\u4F4D\uFF1B\u5982\u679C\u5B89\u88C5\u4E86256\u4F4D\uFF0C\u5219\u4F7F\u7528256\u4F4D\u3002</p><h3 id="usage-1" tabindex="-1"><a class="header-anchor" href="#usage-1" aria-hidden="true">#</a> Usage</h3><p>To show help:</p><pre>./bin/encrypt-config.sh -h
</pre><p>\u4EE5\u4E0B\u662F\u53EF\u7528\u7684\u9009\u9879\uFF1A</p><ul><li><p><code>-h</code>,<code>--help</code> Prints this usage message</p></li><li><p><code>-v</code>,<code>--verbose</code> Sets verbose mode (default false)</p></li><li><p><code>-n</code>,<code>--niFiProperties &lt;arg&gt;</code> The <em>nifi.properties</em> file containing unprotected config values (will be overwritten)</p></li><li><p><code>-l</code>,<code>--loginIdentityProviders &lt;arg&gt;</code> The <em>login-identity-providers.xml</em> file containing unprotected config values (will be overwritten)</p></li><li><p><code>-a</code>,<code>--authorizers &lt;arg&gt;</code> The <em>authorizers.xml</em> file containing unprotected config values (will be overwritten)</p></li><li><p><code>-f</code>,<code>--flowXml &lt;arg&gt;</code> The <em>flow.xml.gz</em> file currently protected with old password (will be overwritten)</p></li><li><p><code>-b</code>,<code>--bootstrapConf &lt;arg&gt;</code> The <em>bootstrap.conf</em> file to persist root key</p></li><li><p><code>-o</code>,<code>--outputNiFiProperties &lt;arg&gt;</code> The destination <em>nifi.properties</em> file containing protected config values (will not modify input <em>nifi.properties</em>)</p></li><li><p><code>-i</code>,<code>--outputLoginIdentityProviders &lt;arg&gt;</code> The destination <em>login-identity-providers.xml</em> file containing protected config values (will not modify input <em>login-identity-providers.xml</em>)</p></li><li><p><code>-u</code>,<code>--outputAuthorizers &lt;arg&gt;</code> The destination <em>authorizers.xml</em> file containing protected config values (will not modify input <em>authorizers.xml</em>)</p></li><li><p><code>-g</code>,<code>--outputFlowXml &lt;arg&gt;</code> The destination <em>flow.xml.gz</em> file containing protected config values (will not modify input <em>flow.xml.gz</em>)</p></li><li><p><code>-k</code>,<code>--key &lt;arg&gt;</code> The raw hexadecimal key to use to encrypt the sensitive properties</p></li><li><p><code>-e</code>,<code>--oldKey &lt;arg&gt;</code> The old raw hexadecimal key to use during key migration</p></li><li><p><code>-p</code>,<code>--password &lt;arg&gt;</code> The password from which to derive the key to use to encrypt the sensitive properties</p></li><li><p><code>-w</code>,<code>--oldPassword &lt;arg&gt;</code> The old password from which to derive the key during migration</p></li><li><p><code>-r</code>,<code>--useRawKey</code> If provided, the secure console will prompt for the raw key value in hexadecimal form</p></li><li><p><code>-m</code>,<code>--migrate</code> If provided, the <em>nifi.properties</em> and/or <em>login-identity-providers.xml</em> sensitive properties will be re-encrypted with a new key</p></li><li><p><code>-x</code>,<code>--encryptFlowXmlOnly</code> If provided, the properties in <em>flow.xml.gz</em> will be re-encrypted with a new key but the <em>nifi.properties</em> and/or <em>login-identity-providers.xml</em> files will not be modified</p></li><li><p><code>-s</code>,<code>--propsKey &lt;arg&gt;</code> The password or key to use to encrypt the sensitive processor properties in <em>flow.xml.gz</em></p></li><li><p><code>-A</code>,<code>--newFlowAlgorithm &lt;arg&gt;</code> The algorithm to use to encrypt the sensitive processor properties in <em>flow.xml.gz</em></p></li><li><p><code>-P</code>,<code>--newFlowProvider &lt;arg&gt;</code> The security provider to use to encrypt the sensitive processor properties in <em>flow.xml.gz</em></p></li></ul><p>\u4F5C\u4E3A\u8BE5\u5DE5\u5177\u5982\u4F55\u5DE5\u4F5C\u7684\u793A\u4F8B\uFF0C\u5047\u8BBE\u60A8\u5DF2\u5C06\u8BE5\u5DE5\u5177\u5B89\u88C5\u5728\u652F\u6301256\u4F4D\u52A0\u5BC6\u5E76\u4E14 <em>nifi.properties</em> \u6587\u4EF6\u4E2D\u5177\u6709\u4EE5\u4E0B\u73B0\u6709\u503C\u7684\u8BA1\u7B97\u673A\u4E0A\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># security properties #
nifi.sensitive.props.key=thisIsABadSensitiveKeyPassword
nifi.sensitive.props.algorithm=PBEWITHMD5AND256BITAES-CBC-OPENSSL
nifi.sensitive.props.provider=BC
nifi.sensitive.props.additional.keys=

nifi.security.keystore=/path/to/keystore.jks
nifi.security.keystoreType=JKS
nifi.security.keystorePasswd=thisIsABadKeystorePassword
nifi.security.keyPasswd=thisIsABadKeyPassword
nifi.security.truststore=
nifi.security.truststoreType=
nifi.security.truststorePasswd=
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Enter the following arguments when using the tool:</p><pre>encrypt-config.sh
-b bootstrap.conf
-k 0123456789ABCDEFFEDCBA98765432100123456789ABCDEFFEDCBA9876543210
-n nifi.properties
</pre><p>\u7ED3\u679C\uFF0C<em>nifi.properties</em> \u6587\u4EF6\u88AB\u53D7\u4FDD\u62A4\u7684\u5C5E\u6027\u548C\u540C\u7EA7\u52A0\u5BC6\u6807\u8BC6\u7B26(\u201Caes/gcm/256\u201D\uFF0C\u5F53\u524D\u652F\u6301\u7684\u7B97\u6CD5)\u8986\u76D6\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># security properties #
nifi.sensitive.props.key=n2z+tTTbHuZ4V4V2||uWhdasyDXD4ZG2lMAes/vqh6u4vaz4xgL4aEbF4Y/dXevqk3ulRcOwf1vc4RDQ==
nifi.sensitive.props.key.protected=aes/gcm/256
nifi.sensitive.props.algorithm=PBEWITHMD5AND256BITAES-CBC-OPENSSL
nifi.sensitive.props.provider=BC
nifi.sensitive.props.additional.keys=

nifi.security.keystore=/path/to/keystore.jks
nifi.security.keystoreType=JKS
nifi.security.keystorePasswd=oBjT92hIGRElIGOh||MZ6uYuWNBrOA6usq/Jt3DaD2e4otNirZDytac/w/KFe0HOkrJR03vcbo
nifi.security.keystorePasswd.protected=aes/gcm/256
nifi.security.keyPasswd=ac/BaE35SL/esLiJ||+ULRvRLYdIDA2VqpE0eQXDEMjaLBMG2kbKOdOwBk/hGebDKlVg==
nifi.security.keyPasswd.protected=aes/gcm/256
nifi.security.truststore=
nifi.security.truststoreType=
nifi.security.truststorePasswd=
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6B64\u5916\uFF0C\u4F7F\u7528\u52A0\u5BC6\u5BC6\u94A5\u66F4\u65B0 _bootstrap.conf_\u6587 \u4EF6\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># Root key in hexadecimal format for encrypted sensitive configuration values
nifi.bootstrap.sensitive.key=0123456789ABCDEFFEDCBA98765432100123456789ABCDEFFEDCBA9876543210
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0C\u8BE5\u5DE5\u5177\u4F1A\u52A0\u5BC6\u654F\u611F\u7684\u914D\u7F6E\u503C\uFF0C\u4F46\u662F\uFF0C\u5982\u679C\u9700\u8981\uFF0C\u60A8\u53EF\u4EE5\u52A0\u5BC6\u4EFB\u4F55\u5176\u4ED6\u5C5E\u6027\u3002\u8981\u52A0\u5BC6\u5176\u4ED6\u5C5E\u6027\uFF0C\u8BF7\u5728<code>nifi.sensitive.props.additional.keys</code>\u5C5E\u6027\u4E2D\u5C06\u5176\u6307\u5B9A\u4E3A\u9017\u53F7\u5206\u9694\u7684\u503C\u3002</p><p>\u5982\u679C <em>nifi.properties</em> \u6587\u4EF6\u5DF2\u7ECF\u5177\u6709\u6709\u6548\u7684\u53D7\u4FDD\u62A4\u503C\uFF0C\u5219\u8BE5\u5DE5\u5177\u4E0D\u4F1A\u4FEE\u6539\u8FD9\u4E9B\u5C5E\u6027\u503C\u3002</p><p>\u5F53\u5E94\u7528\u4E8E <em>login-identity-providers.xml</em> \u548C <em>authorizers.xml</em> \u65F6\uFF0C\u5C5E\u6027\u5143\u7D20\u5C06\u4F7F\u7528<code>encryption</code>\u5C5E\u6027\u8FDB\u884C\u66F4\u65B0\uFF1A</p><p>\u53D7\u4FDD\u62A4\u7684_login-identity-providers.xml_\u7684\u793A\u4F8B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;!-- LDAP Provider --&gt;
   &lt;provider&gt;
       &lt;identifier&gt;ldap-provider&lt;/identifier&gt;
       &lt;class&gt;org.apache.nifi.ldap.LdapProvider&lt;/class&gt;
       &lt;property name=&quot;Authentication Strategy&quot;&gt;START_TLS&lt;/property&gt;
       &lt;property name=&quot;Manager DN&quot;&gt;someuser&lt;/property&gt;
       &lt;property name=&quot;Manager Password&quot; encryption=&quot;aes/gcm/128&quot;&gt;q4r7WIgN0MaxdAKM||SGgdCTPGSFEcuH4RraMYEdeyVbOx93abdWTVSWvh1w+klA&lt;/property&gt;
       &lt;property name=&quot;TLS - Keystore&quot;&gt;&lt;/property&gt;
       &lt;property name=&quot;TLS - Keystore Password&quot; encryption=&quot;aes/gcm/128&quot;&gt;Uah59TWX+Ru5GY5p||B44RT/LJtC08QWA5ehQf01JxIpf0qSJUzug25UwkF5a50g&lt;/property&gt;
       &lt;property name=&quot;TLS - Keystore Type&quot;&gt;&lt;/property&gt;
       ...
   &lt;/provider&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53D7\u4FDD\u62A4\u7684 <em>authorizers.xml</em> \u7684\u793A\u4F8B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;!-- LDAP User Group Provider --&gt;
   &lt;userGroupProvider&gt;
       &lt;identifier&gt;ldap-user-group-provider&lt;/identifier&gt;
       &lt;class&gt;org.apache.nifi.ldap.tenants.LdapUserGroupProvider&lt;/class&gt;
       &lt;property name=&quot;Authentication Strategy&quot;&gt;START_TLS&lt;/property&gt;
       &lt;property name=&quot;Manager DN&quot;&gt;someuser&lt;/property&gt;
       &lt;property name=&quot;Manager Password&quot; encryption=&quot;aes/gcm/128&quot;&gt;q4r7WIgN0MaxdAKM||SGgdCTPGSFEcuH4RraMYEdeyVbOx93abdWTVSWvh1w+klA&lt;/property&gt;
       &lt;property name=&quot;TLS - Keystore&quot;&gt;&lt;/property&gt;
       &lt;property name=&quot;TLS - Keystore Password&quot; encryption=&quot;aes/gcm/128&quot;&gt;Uah59TWX+Ru5GY5p||B44RT/LJtC08QWA5ehQf01JxIpf0qSJUzug25UwkF5a50g&lt;/property&gt;
       &lt;property name=&quot;TLS - Keystore Type&quot;&gt;&lt;/property&gt;
       ...
   &lt;/userGroupProvider&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="file-manager" tabindex="-1"><a class="header-anchor" href="#file-manager" aria-hidden="true">#</a> File Manager</h2><p>File Manager(\u79F0\u4E3A<code>./bin/file-manager.sh</code> <code>bin\\file-manager.bat</code>)\u5141\u8BB8\u7CFB\u7EDF\u7BA1\u7406\u5458\u5BF9\u73B0\u6709NiFi\u5B89\u88C5\u8FDB\u884C\u5907\u4EFD\uFF0C\u5728\u65B0\u7248NiFi\u4E2D\u5B89\u88C5\u6307\u5B9A\u7684\u4F4D\u7F6E(\u5728\u8FC1\u79FB\u4EFB\u4F55\u5148\u524D\u7684\u914D\u7F6E\u8BBE\u7F6E\u65F6)\u6216\u4ECE\u5148\u524D\u7684\u5907\u4EFD\u4E2D\u8FD8\u539F\u5B89\u88C5\u3002\u6587\u4EF6\u7BA1\u7406\u5668\u652F\u6301NiFi 1.0.0\u53CA\u66F4\u9AD8\u7248\u672C\u3002</p><h3 id="usage-2" tabindex="-1"><a class="header-anchor" href="#usage-2" aria-hidden="true">#</a> Usage</h3><p>\u8981\u663E\u793A\u5E2E\u52A9\uFF1A</p><pre>./bin/file-manager.sh -h
</pre><p>\u4EE5\u4E0B\u662F\u53EF\u7528\u7684\u9009\u9879\uFF1A</p><ul><li><p><code>-b</code>,<code>--backupDir &lt;arg&gt;</code> Backup NiFi Directory (used with backup or restore operation)</p></li><li><p><code>-c</code>,<code>--nifiCurrentDir &lt;arg&gt;</code> Current NiFi Installation Directory (used optionally with install or restore operation)</p></li><li><p><code>-d</code>,<code>--nifiInstallDir &lt;arg&gt;</code> NiFi Installation Directory (used with install or restore operation)</p></li><li><p><code>-h</code>,<code>--help</code> Print help info (optional)</p></li><li><p><code>-i</code>,<code>--installFile &lt;arg&gt;</code> NiFi Install File (used with install operation)</p></li><li><p><code>-m</code>,<code>--moveRepositories</code> Allow repositories to be moved to new/restored nifi directory from existing installation, if available (used optionally with install or restore operation)</p></li><li><p><code>-o</code>,<code>--operation &lt;arg&gt;</code> File operation (install | backup | restore)</p></li><li><p><code>-r</code>,<code>--nifiRollbackDir &lt;arg&gt;</code> NiFi Installation Directory (used with install or restore operation)</p></li><li><p><code>-t</code>,<code>--bootstrapConf &lt;arg&gt;</code> Current NiFi Bootstrap Configuration File (used optionally)</p></li><li><p><code>-v</code>,<code>--verbose</code> Verbose messaging (optional)</p></li><li><p><code>-x</code>,<code>--overwriteConfigs</code> Overwrite existing configuration directory with upgrade changes (used optionally with install or restore operation)</p></li></ul><p>\u5728Linux\u4E0A\u7684\u7528\u6CD5\u793A\u4F8B\uFF1A</p><pre># backup NiFi installation
# option -t may be provided to ensure backup of external boostrap.conf file
./file-manager.sh
-o backup
\u2013b /tmp/nifi_bak
\u2013c /usr/nifi_old
-v
</pre><pre># install NiFi using compressed tar file into /usr/nifi directory (should install as /usr/nifi/nifi-1.3.0).
# migrate existing configurations with location determined by external bootstrap.conf and move over repositories from nifi_old
# options -t and -c should both be provided if migration of configurations, state and repositories are required
./file-manager.sh
-o install
\u2013i nifi-1.3.0.tar.gz
\u2013d /usr/nifi
\u2013c /usr/nifi/nifi_old
-t /usr/nifi/old_conf/bootstrap.conf
-v
-m
</pre><pre># restore NiFi installation from backup directory and move back repositories
# option -t may be provided to ensure bootstrap.conf is restored to the file path provided, otherwise it is placed in the
# default directory under the rollback path (e.g. /usr/nifi_old/conf)
./file-manager.sh
-o restore
\u2013b /tmp/nifi_bak
\u2013r /usr/nifi_old
\u2013c /usr/nifi
-m
-v
</pre><h3 id="expected-behavior" tabindex="-1"><a class="header-anchor" href="#expected-behavior" aria-hidden="true">#</a> Expected Behavior</h3><h4 id="backup" tabindex="-1"><a class="header-anchor" href="#backup" aria-hidden="true">#</a> Backup</h4><p>\u5728\u5907\u4EFD\u64CD\u4F5C\u671F\u95F4\uFF0C\u5C06\u5728\u73B0\u6709NiFi\u5B89\u88C5\u7684\u6307\u5B9A\u4F4D\u7F6E\u521B\u5EFA\u5907\u4EFD\u76EE\u5F55\u3002\u5907\u4EFD\u5C06\u6355\u83B7\u6240\u6709\u5173\u952E\u6587\u4EF6(\u5305\u62EC\u4EFB\u4F55\u5185\u90E8\u6216\u5916\u90E8\u914D\u7F6E\uFF0C\u5E93\uFF0C\u811A\u672C\u548C\u6587\u6863)\uFF0C\u4F46\u662F\u7531\u4E8E\u6F5C\u5728\u7684\u5927\u5C0F\uFF0C\u5B83\u4E0D\u5305\u62EC\u5907\u4EFD\u5B58\u50A8\u5E93\u548C\u65E5\u5FD7\u3002\u5982\u679C\u914D\u7F6E/\u5E93\u6587\u4EF6\u4F4D\u4E8E\u73B0\u6709\u5B89\u88C5\u6587\u4EF6\u5939\u7684\u5916\u90E8\uFF0C\u5219\u5907\u4EFD\u64CD\u4F5C\u4E5F\u5C06\u6355\u83B7\u8FD9\u4E9B\u6587\u4EF6\u3002</p><h4 id="install" tabindex="-1"><a class="header-anchor" href="#install" aria-hidden="true">#</a> Install</h4><p>\u5728\u5B89\u88C5\u8FC7\u7A0B\u4E2D\uFF0C\u6587\u4EF6\u7BA1\u7406\u5668\u5C06\u4F7F\u7528\u6307\u5B9A\u7684NiFi\u4E8C\u8FDB\u5236\u6587\u4EF6(tar.gz\u6216zip\u6587\u4EF6)\u6267\u884C\u5B89\u88C5\uFF0C\u4EE5\u521B\u5EFA\u65B0\u5B89\u88C5\u6216\u5C06\u73B0\u6709nifi\u5B89\u88C5\u8FC1\u79FB\u5230\u65B0\u5B89\u88C5\u3002\u5B89\u88C5\u53EF\u4EE5\u9009\u62E9\u5C06\u5B58\u50A8\u5E93(\u5982\u679C\u4F4D\u4E8E\u5F53\u524D\u5B89\u88C5\u7684\u914D\u7F6E\u6587\u4EF6\u5939\u4E2D)\u79FB\u81F3\u65B0\u5B89\u88C5\uFF0C\u4EE5\u53CA\u5C06\u914D\u7F6E\u6587\u4EF6\u8FC1\u79FB\u81F3\u8F83\u65B0\u7684\u5B89\u88C5\u3002</p><h4 id="restore" tabindex="-1"><a class="header-anchor" href="#restore" aria-hidden="true">#</a> Restore</h4><p>\u901A\u8FC7\u8FD8\u539F\u64CD\u4F5C\uFF0C\u73B0\u6709\u5B89\u88C5\u53EF\u4EE5\u8FD8\u539F\u4E3A\u5148\u524D\u7684\u5B89\u88C5\u3002\u4F7F\u7528\u73B0\u6709\u7684\u5907\u4EFD\u76EE\u5F55(\u901A\u8FC7\u5907\u4EFD\u64CD\u4F5C\u521B\u5EFA)\uFF0CFileManager\u5B9E\u7528\u7A0B\u5E8F\u5C06\u8FD8\u539F\u5E93\uFF0C\u811A\u672C\u548C\u6587\u6863\uFF0C\u5E76\u8FD8\u539F\u5230\u4EE5\u524D\u7684\u914D\u7F6E\u3002</p><p>\u6CE8\u610F\uFF1A \u5982\u679C\u7531\u4E8E\u5B89\u88C5\u4E86\u8F83\u65B0\u7248\u672C\u7684NiFi\u800C\u66F4\u6539\u4E86\u5B58\u50A8\u5E93\uFF0C\u5219\u5728\u6062\u590D\u8FC7\u7A0B\u4E2D\u5B83\u4EEC\u53EF\u80FD\u4E0D\u518D\u517C\u5BB9\u3002\u5728\u90A3\u79CD\u60C5\u51B5\u4E0B\uFF0C\u8BF7\u6392\u9664<code>-m</code>\u9009\u9879\u4EE5\u786E\u4FDD\u5C06\u521B\u5EFA\u65B0\u7684\u5B58\u50A8\u5E93\uFF0C\u6216\u8005\uFF0C\u5982\u679C\u5B58\u50A8\u5E93\u4F4D\u4E8ENiFi\u76EE\u5F55\u4E4B\u5916\uFF0C\u8BF7\u5220\u9664\u5B83\u4EEC\uFF0C\u4EE5\u4FBF\u53EF\u4EE5\u5728\u8FD8\u539F\u540E\u542F\u52A8\u65F6\u91CD\u65B0\u521B\u5EFA\u5B83\u4EEC\u3002</p><h2 id="flow-analyzer" tabindex="-1"><a class="header-anchor" href="#flow-analyzer" aria-hidden="true">#</a> Flow Analyzer</h2><p>The <code>flow-analyzer</code> tool (invoked as <code>./bin/flow-analyzer.sh</code> or <code>bin\\flow-analyzer.bat</code>) analyzes the <em>flow.xml.gz</em> file and reports:</p><ul><li><p>Total Bytes Utilized by the System</p></li><li><p>Min/Max Back Pressure Size</p></li><li><p>Average Back Pressure Size</p></li><li><p>Min/Max Flowfile Queue Size</p></li><li><p>Average Flowfile Queue Size</p></li></ul><h3 id="usage-3" tabindex="-1"><a class="header-anchor" href="#usage-3" aria-hidden="true">#</a> Usage</h3><p>\u6267\u884C<code>flow-analyzer</code>\u5DE5\u5177\uFF1A</p><pre>flow-analyzer.sh flow.xml.gz\u8DEF\u5F84
</pre><p>\u4F8B\uFF1A</p><pre>$ ./flow-analyzer.sh /Users/nifiuser/nifi-1.8.0/conf/flow.xml.gz
Using flow=/Users/nifiuser/nifi-1.8.0/conf/flow.xml.gz
Total Bytes Utilized by System=1518 GB
Max Back Pressure Size=1 GB
Min Back Pressure Size=1 GB
Average Back Pressure Size=2.504950495 GB
Max Flowfile Queue Size=10000
Min Flowfile Queue Size=10000
Avg Flowfile Queue Size=10000.000000000
</pre><h2 id="node-manager" tabindex="-1"><a class="header-anchor" href="#node-manager" aria-hidden="true">#</a> Node Manager</h2><p>\u8282\u70B9\u7BA1\u7406\u5668(\u79F0\u4E3A<code>./bin/node-manager.sh</code> or <code>bin\\node-manager.bat</code>)\u652F\u6301\u5728\u7FA4\u96C6\u4E2D\u8FDE\u63A5\uFF0C\u65AD\u5F00\u8FDE\u63A5\u548C\u5220\u9664\u8282\u70B9(\u5982\u679C\u8282\u70B9\u4E0D\u5C5E\u4E8E\u8BE5\u8282\u70B9\uFF0C\u5219\u4F1A\u663E\u793A\u9519\u8BEF\u6D88\u606F\u96C6\u7FA4)\u4EE5\u53CA\u83B7\u53D6\u8282\u70B9\u7684\u72B6\u6001\u3002\u5F53\u8282\u70B9\u4E0E\u7FA4\u96C6\u65AD\u5F00\u8FDE\u63A5\u5E76\u4E14\u9700\u8981\u8FDE\u63A5\u6216\u79FB\u9664\u65F6\uFF0C\u5E94\u63D0\u4F9B\u5DF2\u8FDE\u63A5\u8282\u70B9\u7684URL\u5217\u8868\uFF0C\u4EE5\u5C06\u6240\u9700\u547D\u4EE4\u53D1\u9001\u5230\u6D3B\u52A8\u7FA4\u96C6\u3002\u8282\u70B9\u7BA1\u7406\u5668\u652F\u6301NiFi 1.0.0\u53CA\u66F4\u9AD8\u7248\u672C\u3002</p><h3 id="usage-4" tabindex="-1"><a class="header-anchor" href="#usage-4" aria-hidden="true">#</a> Usage</h3><p>To show help:</p><pre>./bin/node-manager.sh -h
</pre><p>The following are available options:</p><ul><li><p><code>-b</code>,<code>--bootstrapConf &lt;arg&gt;</code> Existing Bootstrap Configuration file (required)</p></li><li><p><code>-d</code>,<code>--nifiInstallDir &lt;arg&gt;</code> NiFi Root Folder (required)</p></li><li><p><code>-h</code>,<code>--help</code> Help Text (optional)</p></li><li><p><code>-o</code>, <code>--operation &lt;arg&gt;</code> Operations supported: status, connect (cluster), disconnect (cluster), remove (cluster)</p></li><li><p><code>-p</code>,<code>--proxyDN &lt;arg&gt;</code> Proxy or User DN (required for secured nodes doing connect, disconnect and remove operations)</p></li><li><p><code>-u</code>,<code>--clusterUrls &lt;arg&gt;</code> Comma delimited list of active urls for cluster (optional). Not required for disconnecting a node yet will be needed when connecting or removing from a cluster</p></li><li><p><code>-v</code>,<code>--verbose</code> Verbose messaging (optional)</p></li></ul><p>To connect, disconnect, or remove a node from a cluster:</p><pre>node-manager.sh -d {$NIFI_HOME} \u2013b { nifi bootstrap file path}
-o {remove|disconnect|connect|status} [-u {url list}] [-p {proxy name}] [-v]
</pre><p>Example usage on Linux:</p><pre># disconnect without cluster url list
./node-manager.sh
-d /usr/nifi/nifi_current
-b /usr/nifi/nifi_current/conf/bootstrap.conf
-o disconnect
\u2013p ydavis@nifi
-v
</pre><pre>#with url list
./node-manager.sh
-d /usr/nifi/nifi_current
-b /usr/nifi/nifi_current/conf/bootstrap.conf
-o connect
-u &#39;http://nifi-server-1:8080,http://nifi-server-2:8080&#39;
-v
</pre><p>Example usage on Windows:</p><pre>node-manager.bat
-d &quot;C:\\\\Program Files\\\\nifi\\\\nifi-1.2.0-SNAPSHOT&quot;
-b &quot;C:\\\\Program Files\\\\nifi\\\\nifi-1.2.0-SNAPSHOT\\\\conf\\\\bootstrap.conf&quot;
-o disconnect
\u2013v
</pre><h3 id="expected-behavior-1" tabindex="-1"><a class="header-anchor" href="#expected-behavior-1" aria-hidden="true">#</a> Expected Behavior</h3><h4 id="status" tabindex="-1"><a class="header-anchor" href="#status" aria-hidden="true">#</a> Status</h4><p>\u8981\u83B7\u53D6\u6709\u5173\u8282\u70B9\u7684UI\u53EF\u7528\u6027\u7684\u4FE1\u606F\uFF0C\u53EF\u4EE5\u4F7F\u7528\u72B6\u6001\u64CD\u4F5C\u6765\u786E\u5B9A\u8282\u70B9\u662F\u5426\u6B63\u5728\u8FD0\u884C\u3002\u5982\u679C\u672A\u63D0\u4F9B<code>-u(clusterUrls)</code>\u9009\u9879\uFF0C\u5219\u68C0\u67E5\u5F53\u524D\u8282\u70B9\u7684URL\uFF0C\u5426\u5219\u5C06\u68C0\u67E5\u63D0\u4F9B\u7684URL\u3002</p><h4 id="disconnect" tabindex="-1"><a class="header-anchor" href="#disconnect" aria-hidden="true">#</a> Disconnect</h4><p>\u5F53\u8282\u70B9\u4ECE\u7FA4\u96C6\u65AD\u5F00\u8FDE\u63A5\u65F6\uFF0C\u8282\u70B9\u672C\u8EAB\u5E94\u663E\u793A\u4E3A\u5DF2\u65AD\u5F00\u8FDE\u63A5\uFF0C\u5E76\u4E14\u7FA4\u96C6\u5E94\u5177\u6709\u516C\u544A\uFF0C\u6307\u793A\u5DF2\u6536\u5230\u65AD\u5F00\u8FDE\u63A5\u8BF7\u6C42\u3002\u7FA4\u96C6\u8FD8\u5E94\u663E\u793A\u7FA4\u96C6\u4E2D\u53EF\u7528\u7684_n-1 /n_\u4E2A\u8282\u70B9\u3002\u4F8B\u5982\uFF0C\u5982\u679C1\u4E2A\u8282\u70B9\u4E0E3\u8282\u70B9\u7FA4\u96C6\u65AD\u5F00\u8FDE\u63A5\uFF0C\u5219\u7FA4\u96C6\u4E2D\u7684\u5176\u4F59\u8282\u70B9\u4E0A\u5E94\u663E\u793A\u201C 2 of 3\u201D\u8282\u70B9\u3002\u5728\u8282\u70B9\u65AD\u5F00\u8FDE\u63A5\u7684\u7FA4\u96C6\u4E0A\uFF0C\u4E0D\u5141\u8BB8\u66F4\u6539\u6D41\u3002</p><h4 id="connect" tabindex="-1"><a class="header-anchor" href="#connect" aria-hidden="true">#</a> Connect</h4><p>\u5F53\u6267\u884Cconnect\u547D\u4EE4\u5C06\u8282\u70B9\u91CD\u65B0\u8FDE\u63A5\u5230\u7FA4\u96C6\u65F6\uFF0C\u5B8C\u6210\u540E\uFF0C\u8282\u70B9\u672C\u8EAB\u5E94\u901A\u8FC7\u663E\u793A <em>n/n</em> \u4E2A\u8282\u70B9\u6765\u8868\u660E\u5B83\u5DF2\u91CD\u65B0\u52A0\u5165\u7FA4\u96C6\u3002\u4EE5\u524D\u5B83\u4F1A\u663E\u793A\u4E3A\u5DF2\u65AD\u5F00\u8FDE\u63A5\u3002\u7FA4\u96C6\u4E2D\u7684\u5176\u4ED6\u8282\u70B9\u5E94\u6536\u5230\u8FDE\u63A5\u8BF7\u6C42\u7684\u516C\u544A\uFF0C\u5E76\u663E\u793A <em>n/n</em> \u4E2A\u8282\u70B9\uFF0C\u4EE5\u5141\u8BB8\u5BF9\u6D41\u8FDB\u884C\u66F4\u6539\u3002</p><h4 id="remove" tabindex="-1"><a class="header-anchor" href="#remove" aria-hidden="true">#</a> Remove</h4><p>\u5F53\u6267\u884Cremove\u547D\u4EE4\u65F6\uFF0C\u8BE5\u8282\u70B9\u5E94\u663E\u793A\u4E3A\u4E0E\u7FA4\u96C6\u65AD\u5F00\u8FDE\u63A5\u3002\u7FA4\u96C6\u4E2D\u5269\u4F59\u7684\u8282\u70B9\u5E94\u663E\u793A <em>n-1/n-1</em> \u4E2A\u8282\u70B9\u3002\u4F8B\u5982\uFF0C\u5982\u679C\u4ECE3\u8282\u70B9\u7FA4\u96C6\u4E2D\u5220\u96641\u4E2A\u8282\u70B9\uFF0C\u5219\u5176\u4F592\u4E2A\u8282\u70B9\u5E94\u663E\u793A\u201C2 of 2\u201D\u4E2A\u8282\u70B9\u3002\u7FA4\u96C6\u5E94\u5141\u8BB8\u8C03\u6574\u6D41\u91CF\u3002\u5982\u679C\u91CD\u65B0\u542F\u52A8\u5E76\u4E14\u8BE5\u96C6\u7FA4\u7684\u6D41\u91CF\u6CA1\u6709\u66F4\u6539\uFF0C\u90A3\u4E48\u5DF2\u5220\u9664\u7684\u8282\u70B9\u53EF\u4EE5\u91CD\u65B0\u52A0\u5165\u8BE5\u96C6\u7FA4\u3002\u5982\u679C\u66F4\u6539\u4E86\u6D41\uFF0C\u5219\u5E94\u5728\u91CD\u65B0\u542F\u52A8\u8282\u70B9\u4E4B\u524D\u5220\u9664\u5DF2\u5220\u9664\u8282\u70B9\u7684\u6D41\u6A21\u677F\uFF0C\u4EE5\u4F7F\u5176\u83B7\u5F97\u7FA4\u96C6\u6D41(\u5426\u5219\u53EF\u80FD\u4F1A\u53D1\u751F\u4E0D\u53EF\u7EE7\u627F\u7684\u6D41\u6587\u4EF6\u5F02\u5E38)\u3002</p><h2 id="notify" tabindex="-1"><a class="header-anchor" href="#notify" aria-hidden="true">#</a> Notify</h2><p>\u901A\u77E5(\u79F0\u4E3A<code>./bin/notify.sh</code> or <code>bin\\notify.bat</code>)\u5141\u8BB8\u7BA1\u7406\u5458\u5C06\u6D88\u606F\u4F5C\u4E3A\u516C\u544A\u53D1\u9001\u5230NiFi\u3002 NiFi\u7248\u672C1.2.0\u548C\u66F4\u9AD8\u7248\u672C\u652F\u6301\u901A\u77E5\u3002</p><h3 id="usage-5" tabindex="-1"><a class="header-anchor" href="#usage-5" aria-hidden="true">#</a> Usage</h3><p>To show help:</p><pre>./bin/notify.sh -h
</pre><p>The following are available options:</p><ul><li><p><code>-b</code>,<code>--bootstrapConf &lt;arg&gt;</code> Existing Bootstrap Configuration file (required)</p></li><li><p><code>-d</code>,<code>--nifiInstallDir &lt;arg&gt;</code> NiFi Root Folder (required)</p></li><li><p><code>-h</code>,<code>--help</code> Help Text (optional)</p></li><li><p><code>-l</code>,<code>--level &lt;arg&gt;</code> Status level of bulletin \u2013 <code>INFO</code>, <code>WARN</code>, <code>ERROR</code></p></li><li><p><code>-m</code>,<code>--message &lt;arg&gt;</code> Bulletin message (required)</p></li><li><p><code>-p</code>,<code>--proxyDN &lt;arg&gt;</code> Proxy or User DN (required for secured nodes)</p></li><li><p><code>-v</code>,<code>--verbose</code> Verbose messaging (optional)</p></li></ul><p>\u53D1\u9001\u901A\u77E5\uFF1A</p><pre>notify.sh -d {$NIFI_HOME} \u2013b {nifi bootstrap file path} -m {message} [-l {level}] [-v]
</pre><p>\u5728Linux\u4E0A\u7684\u7528\u6CD5\u793A\u4F8B\uFF1A</p><pre>./notify.sh -d /usr/nifi/nifi_current -b /usr/nifi/nifi_current/conf/bootstrap.conf -m &quot;Test Message Server 1&quot; -l &quot;WARN&quot; \u2013p \u201Cydavis@nifi\u201D -v
</pre><p>Windows\u4E0A\u7684\u793A\u4F8B\u7528\u6CD5\uFF1A</p><pre>notify.bat -v -d &quot;C:\\\\Program Files\\\\nifi\\\\nifi-1.2.0-SNAPSHOT&quot; -b &quot;C:\\\\Program Files\\\\nifi\\\\nifi-1.2.0-SNAPSHOT\\\\conf\\\\bootstrap.conf&quot; -m &quot;Test Message Server 1&quot; -v
</pre><p>\u6267\u884C\u4E0A\u8FF0\u547D\u4EE4\u884C\u5E94\u8BE5\u4F1A\u5728NiFi\u4E2D\u663E\u793A\u4E00\u4E2A\u516C\u544A\uFF1A</p><p><img src="https://nifichina.gitee.io/image/general/nifi-notifications.png" alt="NiFi Notifications"></p><h2 id="s2s" tabindex="-1"><a class="header-anchor" href="#s2s" aria-hidden="true">#</a> S2S</h2><p>S2S\u662F\u4E00\u79CD\u547D\u4EE4\u884C\u5DE5\u5177(\u79F0\u4E3A<code>./bin/s2s.sh</code> or <code>bin\\s2s.bat</code>)\uFF0C\u53EF\u4EE5\u4ECEstdin\u8BFB\u53D6DataPackets\u5217\u8868\u4EE5\u901A\u8FC7\u7AD9\u70B9\u5230\u7AD9\u70B9\u8FDB\u884C\u53D1\u9001\uFF0C\u4E5F\u53EF\u4EE5\u5199\u5165\u63A5\u6536\u5230\u7684DataPackets\u5230\u6807\u51C6\u8F93\u51FA\u3002</p><h3 id="usage-6" tabindex="-1"><a class="header-anchor" href="#usage-6" aria-hidden="true">#</a> Usage</h3><p>\u8981\u663E\u793A\u5E2E\u52A9\uFF1A</p><pre>./bin/s2s.sh -h
</pre><p>\u4EE5\u4E0B\u662F\u53EF\u7528\u7684\u9009\u9879\uFF1A</p><ul><li><p><code>--batchCount &lt;arg&gt;</code> Number of flow files in a batch</p></li><li><p><code>--batchDuration &lt;arg&gt;</code> Duration of a batch</p></li><li><p><code>--batchSize &lt;arg&gt;</code> Size of flow files in a batch</p></li><li><p><code>-c</code>,<code>--compression</code> Use compression</p></li><li><p><code>-d</code>,<code>--direction</code> Direction (valid directions: <code>SEND</code>, <code>RECEIVE</code>) (default: <code>SEND</code>)</p></li><li><p><code>-h</code>,<code>--help</code> Help Text (optional)</p></li><li><p><code>-i</code>,<code>--portIdentifier &lt;arg&gt;</code> Port id</p></li><li><p><code>--keystore &lt;arg&gt;</code> Keystore</p></li><li><p><code>--keyStorePassword &lt;arg&gt;</code> Keystore password</p></li><li><p><code>--keyStoreType &lt;arg&gt;</code> Keystore type (default: <code>JKS</code>)</p></li><li><p><code>-n</code>,<code>--portName</code> Port name</p></li><li><p><code>-p</code>,<code>--transportProtocol</code> Site to site transport protocol (default: <code>RAW</code>)</p></li><li><p><code>--peerPersistenceFile &lt;arg&gt;</code> File to write peer information to so it can be recovered on restart</p></li><li><p><code>--penalization &lt;arg&gt;</code> Penalization period</p></li><li><p><code>--proxyHost &lt;arg&gt;</code> Proxy hostname</p></li><li><p><code>--proxyPassword &lt;arg&gt;</code> Proxy password</p></li><li><p><code>--proxyPort &lt;arg&gt;</code> Proxy port</p></li><li><p><code>--proxyUsername &lt;arg&gt;</code> Proxy username</p></li><li><p><code>--timeout &lt;arg&gt;</code> Timeout</p></li><li><p><code>--trustStore &lt;arg&gt;</code> Truststore</p></li><li><p><code>--trustStorePassword &lt;arg&gt;</code> Truststore password</p></li><li><p><code>--trustStoreType &lt;arg&gt;</code> Truststore type (default: <code>JKS</code>)</p></li><li><p><code>-u,--url &lt;arg&gt;</code> NiFI URL to connect to (default: <code>http://localhost:8080/nifi</code>)</p></li></ul><p>s2s cli\u8F93\u5165/\u8F93\u51FA\u683C\u5F0F\u662FDataPackets\u7684JSON\u5217\u8868\u3002\u5B83\u4EEC\u53EF\u4EE5\u5177\u6709\u4EE5\u4E0B\u683C\u5F0F\uFF1A</p><pre>[{&quot;attributes&quot;:{&quot;key&quot;:&quot;value&quot;},&quot;data&quot;:&quot;aGVsbG8gbmlmaQ==&quot;}]
</pre><p>\u5176\u4E2Ddata\u662FFlowFile\u5185\u5BB9\u7684base64\u7F16\u7801\u503C(\u59CB\u7EC8\u7528\u4E8E\u63A5\u6536\u7684\u6570\u636E)\u6216\uFF1A</p><pre>[{&quot;attributes&quot;:{&quot;key&quot;:&quot;value&quot;},&quot;dataFile&quot;:&quot;/Users/pvillard/Documents/GitHub/nifi/nifi-toolkit/nifi-toolkit-assembly/target/nifi-toolkit-1.9.0-SNAPSHOT-bin/nifi-toolkit-1.9.0-SNAPSHOT/bin/EXAMPLE&quot;}]
</pre><p>\u5176\u4E2DdataFile\u662F\u4ECE\u4E2D\u8BFB\u53D6FlowFile\u5185\u5BB9\u7684\u6587\u4EF6\u3002</p><p>\u7528\u6CD5\u793A\u4F8B\uFF0C\u901A\u8FC7\u5E26\u6709\u540D\u4E3A\u201Cinput\u201D\u7684\u8F93\u5165\u7AEF\u53E3\u7684HTTP\uFF0C\u5C06\u5185\u5BB9\u4E3A\u201Chey nifi\u201D\u7684FlowFile\u53D1\u9001\u5230\u672C\u5730\u4E0D\u5B89\u5168\u7684NiFi\uFF1A</p><pre>echo &#39;[{&quot;data&quot;:&quot;aGV5IG5pZmk=&quot;}]&#39; | bin/s2s.sh -n input -p http
</pre><h2 id="tls-toolkit" tabindex="-1"><a class="header-anchor" href="#tls-toolkit" aria-hidden="true">#</a> TLS Toolkit</h2><p>\u4E3A\u4E86\u4FC3\u8FDBNiFi\u7684\u5B89\u5168\u8BBE\u7F6E\uFF0C\u60A8\u53EF\u4EE5\u4F7F\u7528<code>tls-toolkit</code>\u547D\u4EE4\u884C\u5B9E\u7528\u7A0B\u5E8F\u81EA\u52A8\u751F\u6210\u6240\u9700\u7684\u5BC6\u94A5\u5E93\uFF0C\u4FE1\u4EFB\u5E93\u548C\u76F8\u5173\u7684\u914D\u7F6E\u6587\u4EF6\u3002\u8FD9\u5BF9\u4E8E\u4FDD\u62A4\u591A\u4E2ANiFi\u8282\u70B9\u7279\u522B\u6709\u7528\uFF0C\u8FD9\u53EF\u80FD\u662F\u4E00\u4E2A\u4E4F\u5473\u4E14\u5BB9\u6613\u51FA\u9519\u7684\u8FC7\u7A0B\u3002</p>`,182),g=i("\u6CE8\u610F\uFF1A \u8BF7\u6CE8\u610F\uFF0CmacOS 10.15\u4E2D\u5BF9\u53D7\u4FE1\u4EFB\u8BC1\u4E66\u6709\u65B0\u8981\u6C42\u3002\u53EF\u4EE5\u5728"),v={href:"https://support.apple.com/zh-cn/HT210176",target:"_blank",rel:"noopener noreferrer"},b=i("here"),y=i("\u4E2D\u627E\u5230\u8BE6\u7EC6\u4FE1\u606F\uFF0C\u4F46\u7279\u522B\u91CD\u8981\u7684\u662F\uFF0C2019\u5E747\u67081\u65E5\u4E4B\u540E\u9881\u53D1\u7684\u6240\u6709TLS\u670D\u52A1\u5668\u8BC1\u4E66\u5FC5\u987B\u5177\u6709\u4E0D\u591A\u4E8E825\u5929\u7684\u6709\u6548\u671F\u3002"),k=o(`<p>Requirements for trusted certificates in iOS 13 and macOS 10.15</p><p>Learn about new security requirements for TLS server certificates in iOS 13 and macOS 10.15.</p><p>All TLS server certificates must comply with these new security requirements in iOS 13 and macOS 10.15:</p><ul><li>TLS server certificates and issuing CAs using RSA keys must use key sizes greater than or equal to 2048 bits. Certificates using RSA key sizes smaller than 2048 bits are no longer trusted for TLS.</li><li>TLS server certificates and issuing CAs must use a hash algorithm from the SHA-2 family in the signature algorithm. SHA-1 signed certificates are no longer trusted for TLS.</li><li>TLS server certificates must present the DNS name of the server in the Subject Alternative Name extension of the certificate. DNS names in the CommonName of a certificate are no longer trusted.</li></ul><p>Additionally, all TLS server certificates issued after July 1, 2019 (as indicated in the NotBefore field of the certificate) must follow these guidelines:</p><ul><li>TLS server certificates must contain an ExtendedKeyUsage (EKU) extension containing the id-kp-serverAuth OID.</li><li>TLS server certificates must have a validity period of 825 days or fewer (as expressed in the NotBefore and NotAfter fields of the certificate).</li></ul><p>Connections to TLS servers violating these new requirements will fail and may cause network failures, apps to fail, and websites to not load in Safari in iOS 13 and macOS 10.15.</p><p>Published Date: November 03, 2019</p><h3 id="\u901A\u914D\u7B26\u8BC1\u4E66-wildcard-certificates" tabindex="-1"><a class="header-anchor" href="#\u901A\u914D\u7B26\u8BC1\u4E66-wildcard-certificates" aria-hidden="true">#</a> \u901A\u914D\u7B26\u8BC1\u4E66(Wildcard Certificates)</h3><p>\u901A\u914D\u7B26\u8BC1\u4E66(\u4E24\u4E2A\u8282\u70B9\u201Cnode1.nifi.apache.org\u201D\u548C\u201Cnode2.nifi.apache.org\u201D\u88AB\u5206\u914D\u4E86\u5177\u6709*.nifi.apache.org\u7684CN\u6216SAN\u6761\u76EE\u7684\u540C\u4E00\u8BC1\u4E66)\u662F<strong>\u4E0D\u88AB\u5B98\u65B9\u652F\u6301</strong>\u548C<strong>\u4E0D\u63A8\u8350</strong>\u3002\u4F7F\u7528\u901A\u914D\u7B26\u8BC1\u4E66\u6709\u8BB8\u591A\u5F0A\u7AEF\uFF0C\u5E76\u4E14\u5728\u4EE5\u524D\u7684\u7248\u672C\u4E2D\uFF0C\u51FA\u4E8E\u5076\u7136(\u800C\u975E\u6709\u610F\u7684\u652F\u6301)\u800C\u51FA\u73B0\u4E86\u4F7F\u7528\u901A\u914D\u7B26\u8BC1\u4E66\u7684\u7FA4\u96C6\u3002 \u5982\u679C\u6BCF\u4E2A\u8BC1\u4E66\u90FD\u7EF4\u62A4\u4E00\u4E2A\u989D\u5916\u7684\u552F\u4E00SAN\u6761\u76EE\u548CCN\u6761\u76EE\uFF0C\u5219\u53EF\u4EE5\u4F7F\u7528\u901A\u914D\u7B26SAN\u6761\u76EE\u3002</p><h4 id="potential-issues-with-wildcard-certificates" tabindex="-1"><a class="header-anchor" href="#potential-issues-with-wildcard-certificates" aria-hidden="true">#</a> Potential issues with wildcard certificates</h4><ul><li><p>\u5728\u6574\u4E2A\u4EE3\u7801\u5E93\u7684\u8BB8\u591A\u5730\u65B9\uFF0C\u7FA4\u96C6\u901A\u4FE1\u591A\u6B21\u4F7F\u7528\u8BC1\u4E66\u6807\u8BC6\u6765\u6807\u8BC6\u8282\u70B9\uFF0C\u5982\u679C\u8BC1\u4E66\u4EC5\u663E\u793A\u901A\u914D\u7B26DN\uFF0C\u5219\u4E0D\u80FD\u89E3\u6790\u4E3A\u7279\u5B9A\u8282\u70B9</p></li><li><p>\u7BA1\u7406\u5458\u53EF\u80FD\u9700\u8981\u5728 <em>authorizers.xml</em> \u4E2D\u4E3A <code>*.nifi.apache.org</code> \u63D0\u4F9B\u4E00\u4E2A\u81EA\u5B9A\u4E49\u8282\u70B9\u8EAB\u4EFD\uFF0C\u56E0\u4E3A\u6240\u6709\u4EE3\u7406\u64CD\u4F5C\u4EC5\u4F1A\u89E3\u6790\u4E3A\u8BC1\u4E66DN\uFF08\u6709\u5173\u66F4\u591A\u4FE1\u606F\uFF0C\u8BF7\u53C2\u89C1\u300A\u7CFB\u7EDF\u7BA1\u7406\u5458\u6307\u5357\u300B\u4E2D\u7684\u7528\u6237\u8EAB\u4EFD\u9A8C\u8BC1\u90E8\u5206\uFF09\u3002</p></li><li><p>\u7BA1\u7406\u5458\u65E0\u6CD5\u8FFD\u6EAF\u5230\u54EA\u4E2A\u8282\u70B9\u6267\u884C\u4E86\u64CD\u4F5C\uFF0C\u56E0\u4E3A\u4ED6\u4EEC\u90FD\u89E3\u6790\u4E3A\u540C\u4E00DN</p></li><li><p>\u7BA1\u7406\u5458\u5728\u540C\u4E00\u53F0\u8BA1\u7B97\u673A\u4E0A\u4F7F\u7528\u4E0D\u540C\u7684\u7AEF\u53E3\u5728\u591A\u4E2A\u5B9E\u4F8B\u4E0A\u8FD0\u884C\u4EE5\u6807\u8BC6\u5B83\u4EEC\u7684\u5B9E\u4F8B\u65F6\uFF0C\u53EF\u80FD\u4F1A\u4E0D\u5C0F\u5FC3\u5C06node1\u4E3B\u673A\u540D\u4E0Enode2\u7AEF\u53E3\u653E\u5728\u4E00\u8D77\uFF0C\u8BE5\u5730\u5740\u5C06\u89E3\u6790\u4E3A\u6B63\u786E\uFF0C\u56E0\u4E3A\u5B83\u4F7F\u7528\u7684\u662F\u76F8\u540C\u7684\u8BC1\u4E66\uFF0C\u4F46\u662F\u4E3B\u673A\u6807\u5934\u5904\u7406\u7A0B\u5E8F\u5C06\u963B\u6B62\u5B83\uFF0C\u56E0\u4E3A\u6CA1\u6709\u6B63\u786E\u5730\u5C06\u201Cnode1\u201D\u4E3B\u673A\u540D\u5217\u51FA\u4E3A\u201Cnode2\u201D\u5B9E\u4F8B\u7684\u53EF\u63A5\u53D7\u4E3B\u673A</p></li><li><p>\u5982\u679C\u901A\u914D\u7B26\u8BC1\u4E66\u88AB\u7834\u574F\uFF0C\u5219\u6240\u6709\u8282\u70B9\u90FD\u88AB\u7834\u574F</p></li></ul><p>\u6CE8\u610F\uFF1A \u5EFA\u8BAE\u5C06JKS\u5BC6\u94A5\u5E93\u548C\u4FE1\u4EFB\u5E93\u7528\u4E8ENiFi\u3002\u8BE5\u5DE5\u5177\u5141\u8BB8\u5728\u547D\u4EE4\u884C\u4E0A\u6307\u5B9A\u5176\u4ED6\u5BC6\u94A5\u5E93\u7C7B\u578B\uFF0C\u4F46\u4F1A\u5FFD\u7565\u7528\u4F5C\u4FE1\u4EFB\u5E93\u7684PKCS12\u7C7B\u578B\uFF0C\u56E0\u4E3A\u8BE5\u683C\u5F0F\u5728BouncyCastle\u548COracle\u5B9E\u73B0\u4E4B\u95F4\u5B58\u5728\u4E00\u4E9B\u517C\u5BB9\u6027\u95EE\u9898\u3002</p><h3 id="\u64CD\u4F5C\u6A21\u5F0F-operation-modes" tabindex="-1"><a class="header-anchor" href="#\u64CD\u4F5C\u6A21\u5F0F-operation-modes" aria-hidden="true">#</a> \u64CD\u4F5C\u6A21\u5F0F(Operation Modes)</h3><p>tls-toolkit\u547D\u4EE4\u884C\u5DE5\u5177\u5177\u6709\u4E24\u79CD\u4E3B\u8981\u7684\u64CD\u4F5C\u6A21\u5F0F\uFF1A</p><ol><li><p>Standalone\uFF08\u72EC\u7ACB\uFF09\u2014 \u5728\u4E00\u4E2A\u547D\u4EE4\u4E2D\u751F\u6210\u8BC1\u4E66\u9881\u53D1\u673A\u6784\uFF0C\u5BC6\u94A5\u5E93\uFF0C\u4FE1\u4EFB\u5E93\u548C <em>nifi.properties</em> \u6587\u4EF6\u3002</p></li><li><p>Client/Server\u2009\u2014\u2009\u4F7F\u7528\u8BC1\u4E66\u9881\u53D1\u673A\u6784\u670D\u52A1\u5668\uFF0C\u8BE5\u670D\u52A1\u5668\u63A5\u53D7\u6765\u81EA\u5BA2\u6237\u7AEF\u7684\u8BC1\u4E66\u7B7E\u540D\u8BF7\u6C42\uFF0C\u5BF9\u5176\u8FDB\u884C\u7B7E\u540D\uFF0C\u7136\u540E\u5C06\u751F\u6210\u7684\u8BC1\u4E66\u53D1\u56DE\u3002\u5BA2\u6237\u7AEF\u548C\u670D\u52A1\u5668\u90FD\u901A\u8FC7\u5171\u4EAB\u673A\u5BC6\u9A8C\u8BC1\u5BF9\u65B9\u7684\u8EAB\u4EFD\u3002</p></li></ol><h4 id="standalone" tabindex="-1"><a class="header-anchor" href="#standalone" aria-hidden="true">#</a> Standalone</h4><p>\u901A\u8FC7\u8FD0\u884C<code>./bin/tls-toolkit.sh standalone</code> or <code>bin\\tls-toolkit.sh standalone</code>\u6765\u8C03\u7528\u72EC\u7ACB\u6A21\u5F0F</p><h5 id="usage-7" tabindex="-1"><a class="header-anchor" href="#usage-7" aria-hidden="true">#</a> Usage</h5><p>\u8981\u663E\u793A\u5E2E\u52A9\uFF1A</p><pre>./bin/tls-toolkit.sh standalone -h
</pre><p>\u4EE5\u4E0B\u662F\u53EF\u7528\u7684\u9009\u9879\uFF1A</p><ul><li><p><code>-a</code>,<code>--keyAlgorithm &lt;arg&gt;</code> \u7528\u4E8E\u751F\u6210\u5BC6\u94A5\u7684\u7B97\u6CD5(\u9ED8\u8BA4: <code>RSA</code>)</p></li><li><p><code>--additionalCACertificate &lt;arg&gt;</code> \u5FC5\u8981\u65F6\u91C7\u7528PEM\u683C\u5F0F\u7684\u5176\u4ED6CA\u8BC1\u4E66\uFF08\u7528\u4E8E\u7B7E\u7F72\u5DE5\u5177\u5305CA\u8BC1\u4E66\uFF09\u7684\u8DEF\u5F84</p></li><li><p><code>-B</code>,<code>--clientCertPassword &lt;arg&gt;</code> \u5BA2\u6237\u8BC1\u4E66\u7684\u5BC6\u7801\u3002\u6BCF\u4E2A\u5BA2\u6237\u7AEFDN\u5FC5\u987B\u4E3A\u4E00\u4E2A\u503C\u6216\u4E00\u4E2A\u503C\uFF08\u5982\u679C\u672A\u6307\u5B9A\uFF0C\u5219\u81EA\u52A8\u751F\u6210\uFF09</p></li><li><p><code>-c</code>,<code>--certificateAuthorityHostname &lt;arg&gt;</code> NiFi\u8BC1\u4E66\u9881\u53D1\u673A\u6784\u7684\u4E3B\u673A\u540D\uFF08\u9ED8\u8BA4\u503C\uFF1A<code>localhost</code>\uFF09</p></li><li><p><code>-C</code>,<code>--clientCertDn &lt;arg&gt;</code> \u751F\u6210\u9002\u7528\u4E8E\u5177\u6709\u6307\u5B9ADN\u7684\u6D4F\u89C8\u5668\u7684\u5BA2\u6237\u7AEF\u8BC1\u4E66\uFF08\u53EF\u4EE5\u591A\u6B21\u6307\u5B9A\uFF09</p></li><li><p><code>-d</code>,<code>--days &lt;arg&gt;</code> \u9881\u53D1\u8BC1\u4E66\u7684\u5929\u6570\u5E94\u5728\uFF08\u6709\u6548\u671F\uFF1A<code>825</code>)</p></li><li><p><code>-f</code>,<code>--nifiPropertiesFile &lt;arg&gt;</code> \u8981\u66F4\u65B0\u7684\u57FA\u672C <em>nifi.properties</em> \u6587\u4EF6\uFF08\u5982\u679C\u672A\u6307\u5B9A\uFF0C\u5219\u5C06\u4F7F\u7528\u4E0E\u9ED8\u8BA4NiFi\u5B89\u88C5\u4E2D\u7684\u5D4C\u5165\u6587\u4EF6\u76F8\u540C\u7684\u5D4C\u5165\u6587\u4EF6\uFF09</p></li><li><p><code>-g</code>,<code>--differentKeyAndKeystorePasswords</code> \u4E3A\u5BC6\u94A5\u548C\u5BC6\u94A5\u5E93\u4F7F\u7528\u4E0D\u540C\u7684\u751F\u6210\u5BC6\u7801</p></li><li><p><code>-G</code>,<code>--globalPortSequence &lt;arg&gt;</code> \u4F7F\u7528\u6839\u636E\u63D0\u4F9B\u7684\u4E3B\u673A\u540D\u8868\u8FBE\u5F0F\u4E3A\u6240\u6709\u4E3B\u673A\u8BA1\u7B97\u7684\u987A\u5E8F\u7AEF\u53E3\uFF08\u53EF\u4EE5\u591A\u6B21\u6307\u5B9A\uFF0C\u4ECE\u8FD0\u884C\u5230\u8FD0\u884C\u5FC5\u987B\u76F8\u540C\uFF09</p></li><li><p><code>-h</code>,<code>--help</code> \u6253\u5370\u5E2E\u52A9\u5E76\u9000\u51FA</p></li><li><p><code>-k</code>,<code>--keySize &lt;arg&gt;</code> \u751F\u6210\u5BC6\u94A5\u7684\u4F4D\u6570\uFF08\u9ED8\u8BA4\u503C\uFF1A2048\uFF09</p></li><li><p><code>-K</code>,<code>--keyPassword &lt;arg&gt;</code> \u8981\u4F7F\u7528\u7684\u5BC6\u94A5\u5BC6\u7801\u3002\u6BCF\u4E2A\u4E3B\u673A\u5FC5\u987B\u4E3A\u4E00\u4E2A\u503C\u6216\u4E00\u4E2A\u503C\uFF08\u5982\u679C\u672A\u6307\u5B9A\uFF0C\u5219\u81EA\u52A8\u751F\u6210\uFF09</p></li><li><p><code>-n</code>,<code>--hostnames &lt;arg&gt;</code> \u4EE5\u9017\u53F7\u5206\u9694\u7684\u4E3B\u673A\u540D\u5217\u8868</p></li><li><p><code>--nifiDnPrefix &lt;arg&gt;</code> \u786E\u5B9ADN\u65F6\u8981\u9644\u52A0\u5230\u4E3B\u673A\u540D\u7684\u5B57\u7B26\u4E32\uFF08\u9ED8\u8BA4\u503C\uFF1A<code>CN =</code>\uFF09</p></li><li><p><code>--nifiDnSuffix &lt;arg&gt;</code> \u786E\u5B9ADN\u65F6\u9644\u52A0\u5230\u4E3B\u673A\u540D\u7684\u5B57\u7B26\u4E32\uFF08\u9ED8\u8BA4\u503C\uFF1A<code>\uFF0COU = NIFI</code>\uFF09</p></li><li><p><code>-o</code>,<code>--outputDirectory &lt;arg&gt;</code> \u8F93\u51FA\u5BC6\u94A5\u5E93\uFF0C\u4FE1\u4EFB\u5E93\uFF0C\u914D\u7F6E\u6587\u4EF6\u7684\u76EE\u5F55\uFF08\u9ED8\u8BA4\uFF1A<code>../bin</code>\uFF09</p></li><li><p><code>-O</code>,<code>--isOverwrite</code> \u8986\u76D6\u73B0\u6709\u4E3B\u673A\u8F93\u51FA</p></li><li><p><code>-P</code>,<code>--trustStorePassword &lt;arg&gt;</code> \u8981\u4F7F\u7528\u7684\u5BC6\u94A5\u5E93\u5BC6\u7801\u3002\u6BCF\u4E2A\u4E3B\u673A\u5FC5\u987B\u4E3A\u4E00\u4E2A\u503C\u6216\u4E00\u4E2A\u503C\uFF08\u5982\u679C\u672A\u6307\u5B9A\uFF0C\u5219\u81EA\u52A8\u751F\u6210\uFF09</p></li><li><p><code>-s</code>,<code>--signingAlgorithm &lt;arg&gt;</code> \u7528\u4E8E\u7B7E\u7F72\u8BC1\u4E66\u7684\u7B97\u6CD5\uFF08\u9ED8\u8BA4\u503C\uFF1A<code>SHA256WITHRSA</code>\uFF09</p></li><li><p><code>-S</code>,<code>--keyStorePassword &lt;arg&gt;</code> \u8981\u4F7F\u7528\u7684\u5BC6\u94A5\u5E93\u5BC6\u7801\u3002\u6BCF\u4E2A\u4E3B\u673A\u5FC5\u987B\u4E3A\u4E00\u4E2A\u503C\u6216\u4E00\u4E2A\u503C\uFF08\u5982\u679C\u672A\u6307\u5B9A\uFF0C\u5219\u81EA\u52A8\u751F\u6210\uFF09</p></li><li><p><code>--subjectAlternativeNames &lt;arg&gt;</code> \u9017\u53F7\u5206\u9694\u7684\u57DF\u5217\u8868\uFF0C\u7528\u4F5C\u8BC1\u4E66\u4E2D\u7684\u4E3B\u9898\u5907\u7528\u540D\u79F0</p></li><li><p><code>-T</code>,<code>--keyStoreType &lt;arg&gt;</code> \u8981\u751F\u6210\u7684\u5BC6\u94A5\u5E93\u7684\u7C7B\u578B\uFF08\u9ED8\u8BA4\u503C\uFF1A<code>jks</code>\uFF09</p></li></ul><p>\u201C\u4E3B\u673A\u540D\u201D\u548C\u201C\u4E3B\u9898\u5907\u7528\u540D\u79F0\u201D\u6A21\u5F0F\uFF1A</p><ul><li><p>\u53EF\u4EE5\u4F7F\u7528\u65B9\u62EC\u53F7\u6765\u8F7B\u677E\u6307\u5B9A\u4E00\u7CFB\u5217\u4E3B\u673A\u540D\u6216\u4E3B\u9898\u5907\u7528\u540D\u79F0\u3002\u4F8B\u5982\uFF1A<code>[01-20]</code></p></li><li><p>\u53EF\u4EE5\u4F7F\u7528\u62EC\u53F7\u6765\u6307\u5B9A\u5728\u7ED9\u5B9A\u7684\u4E3B\u673A\u4E0A\u8FD0\u884C\u591A\u4E2ANiFi\u5B9E\u4F8B\u3002\u793A\u4F8B\uFF1A<code>\uFF085\uFF09</code></p></li></ul><p>\u4F8B\u5B50\uFF1A</p><p>\u4E3A\u672C\u5730\u4E3B\u673A\u521B\u5EFA4\u7EC4\u5BC6\u94A5\u5E93\uFF0C\u4FE1\u4EFB\u5E93\uFF0C<em>nifi.properties</em> \u4EE5\u53CA\u5177\u6709\u7ED9\u5B9ADN\u7684\u5BA2\u6237\u7AEF\u8BC1\u4E66\uFF1A</p><pre>bin/tls-toolkit.sh standalone -n &#39;localhost(4)&#39; -C &#39;CN=username,OU=NIFI&#39;
</pre><p>\u57284\u4E2A\u5B50\u57DF\u7684\u6BCF\u4E2A\u57DF\u4E2D\u4E3A10\u4E2ANiFi\u4E3B\u673A\u540D\u521B\u5EFA\u5BC6\u94A5\u5E93\uFF0C\u4FE1\u4EFB\u5E93\uFF0C<em>nifi.properties</em>\uFF1A</p><pre>bin/tls-toolkit.sh standalone -n &#39;nifi[01-10].subdomain[1-4].domain&#39;
</pre><p>\u57284\u4E2A\u5B50\u57DF\u4E2D\u7684\u6BCF\u4E2A\u57DF\u4E2D\u4E3A10\u4E2ANiFi\u4E3B\u673A\u540D\u521B\u5EFA2\u7EC4\u5BC6\u94A5\u5E93\uFF0C\u4FE1\u4EFB\u5E93_nifi.properties_\u4EE5\u53CA\u5177\u6709\u7ED9\u5B9ADN\u7684\u5BA2\u6237\u7AEF\u8BC1\u4E66\uFF1A</p><pre>bin/tls-toolkit.sh standalone -n &#39;nifi[01-10].subdomain[1-4].domain(2)&#39; -C &#39;CN=username,OU=NIFI&#39;
</pre><p>\u540C\u4E00\u547D\u4EE4\uFF0C\u5E26\u6709\u4E00\u7CFB\u5217\u4E3B\u9898\u5907\u7528\u540D\u79F0\uFF1A</p><pre>bin/tls-toolkit.sh standalone -n &#39;nifi[01-10].subdomain[1-4].domain(2)&#39; -C &#39;CN=username,OU=NIFI&#39; --subjectAlternativeNames &#39;nifi[21-30].other[2-5].example.com(2)&#39;
</pre><h4 id="client-server" tabindex="-1"><a class="header-anchor" href="#client-server" aria-hidden="true">#</a> Client/Server</h4><p>\u5BA2\u6237\u7AEF/\u670D\u52A1\u5668\u6A21\u5F0F\u4F9D\u8D56\u4E8E\u957F\u671F\u8FD0\u884C\u7684\u8BC1\u4E66\u9881\u53D1\u673A\u6784\uFF08CA\uFF09\u9881\u53D1\u8BC1\u4E66\u3002\u5F53\u60A8\u4E0D\u4F7F\u8282\u70B9\u8054\u673A\u65F6\uFF0C\u53EF\u4EE5\u505C\u6B62CA\u3002</p><h5 id="server" tabindex="-1"><a class="header-anchor" href="#server" aria-hidden="true">#</a> Server</h5><p>\u901A\u8FC7\u8FD0\u884C<code>./bin/tls-toolkit.sh server</code> or <code>bin\\tls-toolkit.sh server</code>\u6765\u8C03\u7528CA\u670D\u52A1\u5668\u6A21\u5F0F\u3002</p><h6 id="usage-8" tabindex="-1"><a class="header-anchor" href="#usage-8" aria-hidden="true">#</a> Usage</h6><p>\u8981\u663E\u793A\u5E2E\u52A9\uFF1A</p><pre>./bin/tls-toolkit.sh server -h
</pre><p>The following are available options:</p><ul><li><p><code>-a</code>,<code>--keyAlgorithm &lt;arg&gt;</code> Algorithm to use for generated keys (default: <code>RSA</code>)</p></li><li><p><code>--configJsonIn &lt;arg&gt;</code> The place to read configuration info from (defaults to the value of configJson), implies useConfigJson if set (default: <code>configJson</code> value)</p></li><li><p><code>-d</code>,<code>--days &lt;arg&gt;</code> Number of days issued certificate should be valid for (default: <code>825</code>)</p></li><li><p><code>-D</code>,<code>--dn &lt;arg&gt;</code> The dn to use for the CA certificate (default: <code>CN=YOUR_CA_HOSTNAME,OU=NIFI</code>)</p></li><li><p><code>-f</code>,<code>--configJson &lt;arg&gt;</code> The place to write configuration info (default: <code>config.json</code>)</p></li><li><p><code>-F</code>,<code>--useConfigJson</code> Flag specifying that all configuration is read from <code>configJson</code> to facilitate automated use (otherwise <code>configJson</code> will only be written to)</p></li><li><p><code>-g</code>,<code>--differentKeyAndKeystorePasswords</code> Use different generated password for the key and the keystore</p></li><li><p><code>-h</code>,<code>--help</code> Print help and exit</p></li><li><p><code>-k</code>,<code>--keySize &lt;arg&gt;</code> Number of bits for generated keys (default: <code>2048</code>)</p></li><li><p><code>-p</code>,<code>--PORT &lt;arg&gt;</code> The port for the Certificate Authority to listen on (default: <code>8443</code>)</p></li><li><p><code>-s</code>,<code>--signingAlgorithm &lt;arg&gt;</code> Algorithm to use for signing certificates (default: <code>SHA256WITHRSA</code>)</p></li><li><p><code>-T</code>,<code>--keyStoreType &lt;arg&gt;</code> The type of keystores to generate (default: <code>jks</code>)</p></li><li><p><code>-t</code>,<code>--token &lt;arg&gt;</code> The token to use to prevent MITM (required and must be same as one used by clients)</p></li></ul><h5 id="client" tabindex="-1"><a class="header-anchor" href="#client" aria-hidden="true">#</a> Client</h5><p>\u5BA2\u6237\u7AEF\u53EF\u7528\u4E8E\u4ECECA\u8BF7\u6C42\u65B0\u8BC1\u4E66\u3002\u5BA2\u6237\u7AEF\u5B9E\u7528\u7A0B\u5E8F\u751F\u6210\u5BC6\u94A5\u5BF9\u548C\u8BC1\u4E66\u7B7E\u540D\u8BF7\u6C42\uFF08CSR\uFF09\uFF0C\u5E76\u5C06CSR\u53D1\u9001\u5230\u8BC1\u4E66\u9881\u53D1\u673A\u6784\u3002\u901A\u8FC7\u8FD0\u884C<code>./bin/tls-toolkit.sh client</code> or <code>bin\\tls-toolkit.sh client</code>\u6765\u8C03\u7528CA\u5BA2\u6237\u6A21\u5F0F\u3002</p><h6 id="usage-9" tabindex="-1"><a class="header-anchor" href="#usage-9" aria-hidden="true">#</a> Usage</h6><p>\u8981\u663E\u793A\u5E2E\u52A9\uFF1A</p><pre>./bin/tls-toolkit.sh client -h
</pre><p>\u4EE5\u4E0B\u662F\u53EF\u7528\u7684\u9009\u9879\uFF1A</p><ul><li><p><code>-a</code>,<code>--keyAlgorithm &lt;arg&gt;</code> Algorithm to use for generated keys (default: <code>RSA</code>)</p></li><li><p><code>-c</code>,<code>--certificateAuthorityHostname &lt;arg&gt;</code> Hostname of NiFi Certificate Authority (default: <code>localhost</code>)</p></li><li><p><code>-C</code>,<code>--certificateDirectory &lt;arg&gt;</code> The directory to write the CA certificate (default: <code>.</code>)</p></li><li><p><code>--configJsonIn &lt;arg&gt;</code> The place to read configuration info from, implies <code>useConfigJson</code> if set (default: <code>configJson</code> value)</p></li><li><p><code>-D</code>,<code>--dn &lt;arg&gt;</code> The DN to use for the client certificate (default: <code>CN=&lt;localhost name&gt;,OU=NIFI</code>) (this is auto-populated by the tool)</p></li><li><p><code>-f</code>,<code>--configJson &lt;arg&gt;</code> The place to write configuration info (default: <code>config.json</code>)</p></li><li><p><code>-F</code>,<code>--useConfigJson</code> Flag specifying that all configuration is read from <code>configJson</code> to facilitate automated use (otherwise <code>configJson</code> will only be written to)</p></li><li><p><code>-g</code>,<code>--differentKeyAndKeystorePasswords</code> Use different generated password for the key and the keystore</p></li><li><p><code>-h</code>,<code>--help</code> Print help and exit</p></li><li><p><code>-k</code>,<code>--keySize &lt;arg&gt;</code> Number of bits for generated keys (default: <code>2048</code>)</p></li><li><p><code>-p</code>,<code>--PORT &lt;arg&gt;</code> The port to use to communicate with the Certificate Authority (default: <code>8443</code>)</p></li><li><p><code>--subjectAlternativeNames &lt;arg&gt;</code> Comma-separated list of domains to use as Subject Alternative Names in the certificate</p></li><li><p><code>-T</code>,<code>--keyStoreType &lt;arg&gt;</code> The type of keystores to generate (default: <code>jks</code>)</p></li><li><p><code>-t</code>,<code>--token &lt;arg&gt;</code> The token to use to prevent MITM (required and must be same as one used by CA)</p></li></ul><p>After running the client you will have the CA\u2019s certificate, a keystore, a truststore, and a <code>config.json</code> with information about them as well as their passwords.</p><p>For a client certificate that can be easily imported into the browser, specify: <code>-T PKCS12</code>.</p><h3 id="\u4F7F\u7528\u73B0\u6709\u7684intermediate-ca-using-an-existing-intermediate-certificate-authority" tabindex="-1"><a class="header-anchor" href="#\u4F7F\u7528\u73B0\u6709\u7684intermediate-ca-using-an-existing-intermediate-certificate-authority" aria-hidden="true">#</a> \u4F7F\u7528\u73B0\u6709\u7684Intermediate CA(Using An Existing Intermediate Certificate Authority)</h3><p>In some enterprise scenarios, a security/IT team may provide a signing certificate that has already been signed by the organization\u2019s certificate authority (CA). This <strong>intermediate CA</strong> can be used to sign the <strong>node</strong> (sometimes referred to as <strong>leaf</strong>) certificates that will be installed on each NiFi node, or the <strong>client certificates</strong> used to identify users. In order to inject the existing signing certificate into the toolkit process, follow these steps:</p><ol><li><p>Generate or obtain the signed intermediate CA keys in the following format (see additional commands below):</p><ul><li><p>Public certificate in PEM format: <code>nifi-cert.pem</code></p></li><li><p>Private key in PEM format: <code>nifi-key.key</code></p></li></ul></li><li><p>Place the files in the <strong>toolkit working directory</strong>. This is the directory where the tool is configured to output the signed certificates. <strong>This is not necessarily the directory where the binary is located or invoked</strong>.</p><ul><li><p>For example, given the following scenario, the toolkit command can be run from its location as long as the output directory <code>-o</code> is <code>../hardcoded/</code>, and the existing <code>nifi-cert.pem</code> and <code>nifi-key.key</code> will be used.</p><ul><li>e.g. <code>$ ./toolkit/bin/tls-toolkit.sh standalone -o ./hardcoded/ -n &#39;node4.nifi.apache.org&#39; -P thisIsABadPassword -S thisIsABadPassword -O</code> will result in a new directory at <code>./hardcoded/node4.nifi.apache.org</code> with a keystore and truststore containing a certificate signed by <code>./hardcoded/nifi-key.key</code></li></ul></li><li><p>If the <code>-o</code> argument is not provided, the default working directory (<code>.</code>) must contain <code>nifi-cert.pem</code> and <code>nifi-key.key</code></p><ul><li>e.g. <code>$ cd ./hardcoded/ &amp;&amp; ../toolkit/bin/tls-toolkit.sh standalone -n &#39;node5.nifi.apache.org&#39; -P thisIsABadPassword -S thisIsABadPassword -O</code></li></ul></li></ul></li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># Example directory structure *before* commands above are run

\u{1F513} 0s @ 18:07:58 $ tree -L 2
.
\u251C\u2500\u2500 hardcoded
\u2502   \u251C\u2500\u2500 CN=myusername.hardcoded_OU=NiFi.p12
\u2502   \u251C\u2500\u2500 CN=myusername.hardcoded_OU=NiFi.password
\u2502   \u251C\u2500\u2500 nifi-cert.pem
\u2502   \u251C\u2500\u2500 nifi-key.key
\u2502   \u251C\u2500\u2500 node1.nifi.apache.org
\u2502   \u251C\u2500\u2500 node2.nifi.apache.org
\u2502   \u2514\u2500\u2500 node3.nifi.apache.org
\u2514\u2500\u2500 toolkit
    \u251C\u2500\u2500 LICENSE
    \u251C\u2500\u2500 NOTICE
    \u251C\u2500\u2500 README
    \u251C\u2500\u2500 bin
    \u251C\u2500\u2500 conf
    \u251C\u2500\u2500 docs
    \u2514\u2500\u2500 lib
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The <code>nifi-cert.pem</code> and <code>nifi-key.key</code> files should be ASCII-armored (Base64-encoded ASCII) files containing the CA public certificate and private key respectively. Here are sample files of each to show the expected format:</p>`,57),w={id:"nifi-cert-pem",tabindex:"-1"},x=e("a",{class:"header-anchor",href:"#nifi-cert-pem","aria-hidden":"true"},"#",-1),A=i(),N={href:"https://nifi.apache.org/docs/nifi-docs/html/toolkit-guide.html#nifi-cert-pem",target:"_blank",rel:"noopener noreferrer"},C=i("nifi-cert.pem"),F=o(`<div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># The first command shows the actual content of the encoded file, and the second parses it and shows the internal values

.../certs $ more nifi-cert.pem
-----BEGIN CERTIFICATE-----
MIIDZTCCAk2gAwIBAgIKAWTeM3kDAAAAADANBgkqhkiG9w0BAQsFADAxMQ0wCwYD
VQQLDAROSUZJMSAwHgYDVQQDDBduaWZpLWNhLm5pZmkuYXBhY2hlLm9yZzAeFw0x
ODA3MjgwMDA0MzJaFw0yMTA3MjcwMDA0MzJaMDExDTALBgNVBAsMBE5JRkkxIDAe
BgNVBAMMF25pZmktY2EubmlmaS5hcGFjaGUub3JnMIIBIjANBgkqhkiG9w0BAQEF
AAOCAQ8AMIIBCgKCAQEAqkVrrC+AkFbjnCpupSy84tTFDsRVUIWYj/k2pVwC145M
3bpr0pRCzLuzovAjFCmT5L+isTvNjhionsqif07Ebd/M2psYE/Rih2MULsX6KgRe
1nRUiBeKF08hlmSBMGDFPj39yDzE/V9edxV/KGjRqVgw/Qy0vwaS5uWdXnLDhzoV
4/Mz7lGmYoMasZ1uexlH93jjBl1+EFL2Xoa06oLbEojJ9TKaWhpG8ietEedf7WM0
zqBEz2kHo9ddFk9yxiCkT4SUKnDWkhwc/o6us1vEXoSw+tmufHY/A3gVihjWPIGz
qyLFl9JuN7CyJepkVVqTdskBG7S85G/kBlizUj5jOwIDAQABo38wfTAOBgNVHQ8B
Af8EBAMCAf4wDAYDVR0TBAUwAwEB/zAdBgNVHQ4EFgQUKiWBKbMMQ1zUabD4gI7L
VOWOcy0wHwYDVR0jBBgwFoAUKiWBKbMMQ1zUabD4gI7LVOWOcy0wHQYDVR0lBBYw
FAYIKwYBBQUHAwIGCCsGAQUFBwMBMA0GCSqGSIb3DQEBCwUAA4IBAQAxfHFIZLOw
mwIqnSI/ir8f/uzDMq06APHGdhdeIKV0HR74BtK95KFg42zeXxAEFeic98PC/FPV
tKpm2WUa1slMB+oP27cRx5Znr2+pktaqnM7f2JgMeJ8bduNH3RUkr9jwgkcJRwyC
I4fwHC9k18aizNdOf2q2UgQXxNXaLYPe17deuNVwwrflMgeFfVrwbT2uPJTMRi1D
FQyc6haF4vsOSSRzE6OyDoc+/1PpyPW75OeSXeVCbc3AEAvRuTZMBQvBQUqVM51e
MDG+K3rCeieSBPOnGNrEC/PiA/CvaMXBEog+xPAw1SgYfuCz4rlM3BdRa54z3+oO
lc8xbzd7w8Q3
-----END CERTIFICATE-----
.../certs $ openssl x509 -in nifi-cert.pem -text -noout
Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number:
            01:64:de:33:79:03:00:00:00:00
    Signature Algorithm: sha256WithRSAEncryption
        Issuer: OU=NIFI, CN=nifi-ca.nifi.apache.org
        Validity
            Not Before: Jul 28 00:04:32 2018 GMT
            Not After : Jul 27 00:04:32 2021 GMT
        Subject: OU=NIFI, CN=nifi-ca.nifi.apache.org
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                Public-Key: (2048 bit)
                Modulus:
                    00:aa:45:6b:ac:2f:80:90:56:e3:9c:2a:6e:a5:2c:
                    bc:e2:d4:c5:0e:c4:55:50:85:98:8f:f9:36:a5:5c:
                    02:d7:8e:4c:dd:ba:6b:d2:94:42:cc:bb:b3:a2:f0:
                    23:14:29:93:e4:bf:a2:b1:3b:cd:8e:18:a8:9e:ca:
                    a2:7f:4e:c4:6d:df:cc:da:9b:18:13:f4:62:87:63:
                    14:2e:c5:fa:2a:04:5e:d6:74:54:88:17:8a:17:4f:
                    21:96:64:81:30:60:c5:3e:3d:fd:c8:3c:c4:fd:5f:
                    5e:77:15:7f:28:68:d1:a9:58:30:fd:0c:b4:bf:06:
                    92:e6:e5:9d:5e:72:c3:87:3a:15:e3:f3:33:ee:51:
                    a6:62:83:1a:b1:9d:6e:7b:19:47:f7:78:e3:06:5d:
                    7e:10:52:f6:5e:86:b4:ea:82:db:12:88:c9:f5:32:
                    9a:5a:1a:46:f2:27:ad:11:e7:5f:ed:63:34:ce:a0:
                    44:cf:69:07:a3:d7:5d:16:4f:72:c6:20:a4:4f:84:
                    94:2a:70:d6:92:1c:1c:fe:8e:ae:b3:5b:c4:5e:84:
                    b0:fa:d9:ae:7c:76:3f:03:78:15:8a:18:d6:3c:81:
                    b3:ab:22:c5:97:d2:6e:37:b0:b2:25:ea:64:55:5a:
                    93:76:c9:01:1b:b4:bc:e4:6f:e4:06:58:b3:52:3e:
                    63:3b
                Exponent: 65537 (0x10001)
        X509v3 extensions:
            X509v3 Key Usage: critical
                Digital Signature, Non Repudiation, Key Encipherment, Data Encipherment, Key Agreement, Certificate Sign, CRL Sign
            X509v3 Basic Constraints:
                CA:TRUE
            X509v3 Subject Key Identifier:
                2A:25:81:29:B3:0C:43:5C:D4:69:B0:F8:80:8E:CB:54:E5:8E:73:2D
            X509v3 Authority Key Identifier:
                keyid:2A:25:81:29:B3:0C:43:5C:D4:69:B0:F8:80:8E:CB:54:E5:8E:73:2D

            X509v3 Extended Key Usage:
                TLS Web Client Authentication, TLS Web Server Authentication
    Signature Algorithm: sha256WithRSAEncryption
         31:7c:71:48:64:b3:b0:9b:02:2a:9d:22:3f:8a:bf:1f:fe:ec:
         c3:32:ad:3a:00:f1:c6:76:17:5e:20:a5:74:1d:1e:f8:06:d2:
         bd:e4:a1:60:e3:6c:de:5f:10:04:15:e8:9c:f7:c3:c2:fc:53:
         d5:b4:aa:66:d9:65:1a:d6:c9:4c:07:ea:0f:db:b7:11:c7:96:
         67:af:6f:a9:92:d6:aa:9c:ce:df:d8:98:0c:78:9f:1b:76:e3:
         47:dd:15:24:af:d8:f0:82:47:09:47:0c:82:23:87:f0:1c:2f:
         64:d7:c6:a2:cc:d7:4e:7f:6a:b6:52:04:17:c4:d5:da:2d:83:
         de:d7:b7:5e:b8:d5:70:c2:b7:e5:32:07:85:7d:5a:f0:6d:3d:
         ae:3c:94:cc:46:2d:43:15:0c:9c:ea:16:85:e2:fb:0e:49:24:
         73:13:a3:b2:0e:87:3e:ff:53:e9:c8:f5:bb:e4:e7:92:5d:e5:
         42:6d:cd:c0:10:0b:d1:b9:36:4c:05:0b:c1:41:4a:95:33:9d:
         5e:30:31:be:2b:7a:c2:7a:27:92:04:f3:a7:18:da:c4:0b:f3:
         e2:03:f0:af:68:c5:c1:12:88:3e:c4:f0:30:d5:28:18:7e:e0:
         b3:e2:b9:4c:dc:17:51:6b:9e:33:df:ea:0e:95:cf:31:6f:37:
         7b:c3:c4:37
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),S={id:"nifi-key-key",tabindex:"-1"},T=e("a",{class:"header-anchor",href:"#nifi-key-key","aria-hidden":"true"},"#",-1),P=i(),_={href:"https://nifi.apache.org/docs/nifi-docs/html/toolkit-guide.html#nifi-key-key",target:"_blank",rel:"noopener noreferrer"},I=i("nifi-key.key"),q=o(`<div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># The first command shows the actual content of the encoded file, and the second parses it and shows the internal values

.../certs $ more nifi-key.key
-----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEAqkVrrC+AkFbjnCpupSy84tTFDsRVUIWYj/k2pVwC145M3bpr
0pRCzLuzovAjFCmT5L+isTvNjhionsqif07Ebd/M2psYE/Rih2MULsX6KgRe1nRU
iBeKF08hlmSBMGDFPj39yDzE/V9edxV/KGjRqVgw/Qy0vwaS5uWdXnLDhzoV4/Mz
7lGmYoMasZ1uexlH93jjBl1+EFL2Xoa06oLbEojJ9TKaWhpG8ietEedf7WM0zqBE
z2kHo9ddFk9yxiCkT4SUKnDWkhwc/o6us1vEXoSw+tmufHY/A3gVihjWPIGzqyLF
l9JuN7CyJepkVVqTdskBG7S85G/kBlizUj5jOwIDAQABAoIBAAdWRnV89oVBuT0Z
dvsXGmyLzpH8U9DMcO6DRp+Jf3XaY+WKCutgCCDaVbtHrbtIr17EAzav5QOifGGb
SbVCp6Q0aJdi5360oSpEUrJRRZ5Z4dxL1vimSwUGG+RnIEn9YYJ1GWJve+2PFnr7
KieLnL03V6UPzxoMJnhcnJNdTp+dBwzSazVQwye2csSJlVMk49t2lxBwce7ohuh+
9fL7G3HU5S9d08QT1brknMHahcw1SYyJd0KSjRJCB6wAxnAZmJYJ1jQCI8YICq0j
RX2rhxEXuEMXQcaiFQXzCrmQEXreKUISDvNeu/h7YU9UvJWPZSFGnEGgnMP2XvQm
EjK3rQECgYEA5+OkpLsiLNMHGzj72PiBkq82sTLQJ2+8udYp6PheOGkhjjXoBse5
YynyHlQt6CnVpJQ33mQUkJ+3ils0SMFtmI3rz3udzleek1so2L2J3+CI4kt7fFCb
FFbVXv+dLNrm+tOw68J48asyad8kEnHYq9Us+/3MLDmFJYTthkgzCpECgYEAu/ml
lQaWaZAQcQ8UuVeasxMYoN8zMmzfrkxc8AfNwKxF9nc44ywo4nJr+u/UVRGYpRgM
rdll5vz0Iq68qk03spaW7vDJn8hJQhkReQw1it9Fp/51r9MHzGTVarORJGa2oZ0g
iNe8LNizD3bQ19hEvju9mn0x9Q62Q7dapVpffwsCgYEAtC1TPpQQ59dIjERom5vr
wffWfTTIO/w8HgFkKxrgyuAVLJSCJtKFH6H1+M7bpKrsz6ZDCs+kkwMm76ASLf3t
lD2h3mNkqHG4SzLnuBD90jB666pO1rci6FjYDap7i+DC3F4j9+vxYYXt9Aln09UV
z94hx+LaA/rlk9OHY3EyB6ECgYBA/cCtNNjeaKv2mxM8PbjD/289d85YueHgfpCH
gPs3iZiq7W+iw8ri+FKzMSaFvw66zgTcOtULtxulviqG6ym9umk29dOQRgxmKQqs
gnckq6uGuOjxwJHqrlZHjQw6vLSaThxIk+aAzu+iAh+U8TZbW4ZjmrOiGdMUuJlD
oGpyHwKBgQCRjfqQjRelYVtU7j6BD9BDbCfmipwaRNP0CuAGOVtS+UnJuaIhsXFQ
QGEBuOnfFijIvb7YcXRL4plRYPMvDqYRNObuI6A+1xNtr000nxa/HUfzKVeI9Tsn
9AKMWnXS8ZcfStsVf3oDFffXYRqCaWeuhpMmg9TwdXoAuwfpE5GCmw==
-----END RSA PRIVATE KEY-----
.../certs $ openssl rsa -in nifi-key.key -text -noout
Private-Key: (2048 bit)
modulus:
    00:aa:45:6b:ac:2f:80:90:56:e3:9c:2a:6e:a5:2c:
    bc:e2:d4:c5:0e:c4:55:50:85:98:8f:f9:36:a5:5c:
    02:d7:8e:4c:dd:ba:6b:d2:94:42:cc:bb:b3:a2:f0:
    23:14:29:93:e4:bf:a2:b1:3b:cd:8e:18:a8:9e:ca:
    a2:7f:4e:c4:6d:df:cc:da:9b:18:13:f4:62:87:63:
    14:2e:c5:fa:2a:04:5e:d6:74:54:88:17:8a:17:4f:
    21:96:64:81:30:60:c5:3e:3d:fd:c8:3c:c4:fd:5f:
    5e:77:15:7f:28:68:d1:a9:58:30:fd:0c:b4:bf:06:
    92:e6:e5:9d:5e:72:c3:87:3a:15:e3:f3:33:ee:51:
    a6:62:83:1a:b1:9d:6e:7b:19:47:f7:78:e3:06:5d:
    7e:10:52:f6:5e:86:b4:ea:82:db:12:88:c9:f5:32:
    9a:5a:1a:46:f2:27:ad:11:e7:5f:ed:63:34:ce:a0:
    44:cf:69:07:a3:d7:5d:16:4f:72:c6:20:a4:4f:84:
    94:2a:70:d6:92:1c:1c:fe:8e:ae:b3:5b:c4:5e:84:
    b0:fa:d9:ae:7c:76:3f:03:78:15:8a:18:d6:3c:81:
    b3:ab:22:c5:97:d2:6e:37:b0:b2:25:ea:64:55:5a:
    93:76:c9:01:1b:b4:bc:e4:6f:e4:06:58:b3:52:3e:
    63:3b
publicExponent: 65537 (0x10001)
privateExponent:
    07:56:46:75:7c:f6:85:41:b9:3d:19:76:fb:17:1a:
    6c:8b:ce:91:fc:53:d0:cc:70:ee:83:46:9f:89:7f:
    75:da:63:e5:8a:0a:eb:60:08:20:da:55:bb:47:ad:
    bb:48:af:5e:c4:03:36:af:e5:03:a2:7c:61:9b:49:
    b5:42:a7:a4:34:68:97:62:e7:7e:b4:a1:2a:44:52:
    b2:51:45:9e:59:e1:dc:4b:d6:f8:a6:4b:05:06:1b:
    e4:67:20:49:fd:61:82:75:19:62:6f:7b:ed:8f:16:
    7a:fb:2a:27:8b:9c:bd:37:57:a5:0f:cf:1a:0c:26:
    78:5c:9c:93:5d:4e:9f:9d:07:0c:d2:6b:35:50:c3:
    27:b6:72:c4:89:95:53:24:e3:db:76:97:10:70:71:
    ee:e8:86:e8:7e:f5:f2:fb:1b:71:d4:e5:2f:5d:d3:
    c4:13:d5:ba:e4:9c:c1:da:85:cc:35:49:8c:89:77:
    42:92:8d:12:42:07:ac:00:c6:70:19:98:96:09:d6:
    34:02:23:c6:08:0a:ad:23:45:7d:ab:87:11:17:b8:
    43:17:41:c6:a2:15:05:f3:0a:b9:90:11:7a:de:29:
    42:12:0e:f3:5e:bb:f8:7b:61:4f:54:bc:95:8f:65:
    21:46:9c:41:a0:9c:c3:f6:5e:f4:26:12:32:b7:ad:
    01
prime1:
    00:e7:e3:a4:a4:bb:22:2c:d3:07:1b:38:fb:d8:f8:
    81:92:af:36:b1:32:d0:27:6f:bc:b9:d6:29:e8:f8:
    5e:38:69:21:8e:35:e8:06:c7:b9:63:29:f2:1e:54:
    2d:e8:29:d5:a4:94:37:de:64:14:90:9f:b7:8a:5b:
    34:48:c1:6d:98:8d:eb:cf:7b:9d:ce:57:9e:93:5b:
    28:d8:bd:89:df:e0:88:e2:4b:7b:7c:50:9b:14:56:
    d5:5e:ff:9d:2c:da:e6:fa:d3:b0:eb:c2:78:f1:ab:
    32:69:df:24:12:71:d8:ab:d5:2c:fb:fd:cc:2c:39:
    85:25:84:ed:86:48:33:0a:91
prime2:
    00:bb:f9:a5:95:06:96:69:90:10:71:0f:14:b9:57:
    9a:b3:13:18:a0:df:33:32:6c:df:ae:4c:5c:f0:07:
    cd:c0:ac:45:f6:77:38:e3:2c:28:e2:72:6b:fa:ef:
    d4:55:11:98:a5:18:0c:ad:d9:65:e6:fc:f4:22:ae:
    bc:aa:4d:37:b2:96:96:ee:f0:c9:9f:c8:49:42:19:
    11:79:0c:35:8a:df:45:a7:fe:75:af:d3:07:cc:64:
    d5:6a:b3:91:24:66:b6:a1:9d:20:88:d7:bc:2c:d8:
    b3:0f:76:d0:d7:d8:44:be:3b:bd:9a:7d:31:f5:0e:
    b6:43:b7:5a:a5:5a:5f:7f:0b
exponent1:
    00:b4:2d:53:3e:94:10:e7:d7:48:8c:44:68:9b:9b:
    eb:c1:f7:d6:7d:34:c8:3b:fc:3c:1e:01:64:2b:1a:
    e0:ca:e0:15:2c:94:82:26:d2:85:1f:a1:f5:f8:ce:
    db:a4:aa:ec:cf:a6:43:0a:cf:a4:93:03:26:ef:a0:
    12:2d:fd:ed:94:3d:a1:de:63:64:a8:71:b8:4b:32:
    e7:b8:10:fd:d2:30:7a:eb:aa:4e:d6:b7:22:e8:58:
    d8:0d:aa:7b:8b:e0:c2:dc:5e:23:f7:eb:f1:61:85:
    ed:f4:09:67:d3:d5:15:cf:de:21:c7:e2:da:03:fa:
    e5:93:d3:87:63:71:32:07:a1
exponent2:
    40:fd:c0:ad:34:d8:de:68:ab:f6:9b:13:3c:3d:b8:
    c3:ff:6f:3d:77:ce:58:b9:e1:e0:7e:90:87:80:fb:
    37:89:98:aa:ed:6f:a2:c3:ca:e2:f8:52:b3:31:26:
    85:bf:0e:ba:ce:04:dc:3a:d5:0b:b7:1b:a5:be:2a:
    86:eb:29:bd:ba:69:36:f5:d3:90:46:0c:66:29:0a:
    ac:82:77:24:ab:ab:86:b8:e8:f1:c0:91:ea:ae:56:
    47:8d:0c:3a:bc:b4:9a:4e:1c:48:93:e6:80:ce:ef:
    a2:02:1f:94:f1:36:5b:5b:86:63:9a:b3:a2:19:d3:
    14:b8:99:43:a0:6a:72:1f
coefficient:
    00:91:8d:fa:90:8d:17:a5:61:5b:54:ee:3e:81:0f:
    d0:43:6c:27:e6:8a:9c:1a:44:d3:f4:0a:e0:06:39:
    5b:52:f9:49:c9:b9:a2:21:b1:71:50:40:61:01:b8:
    e9:df:16:28:c8:bd:be:d8:71:74:4b:e2:99:51:60:
    f3:2f:0e:a6:11:34:e6:ee:23:a0:3e:d7:13:6d:af:
    4d:34:9f:16:bf:1d:47:f3:29:57:88:f5:3b:27:f4:
    02:8c:5a:75:d2:f1:97:1f:4a:db:15:7f:7a:03:15:
    f7:d7:61:1a:82:69:67:ae:86:93:26:83:d4:f0:75:
    7a:00:bb:07:e9:13:91:82:9b
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),E={id:"signing-with-externally-signed-ca-certificates",tabindex:"-1"},K=e("a",{class:"header-anchor",href:"#signing-with-externally-signed-ca-certificates","aria-hidden":"true"},"#",-1),z=i(),D={href:"https://nifi.apache.org/docs/nifi-docs/html/toolkit-guide.html#tls_external-signed_ca",target:"_blank",rel:"noopener noreferrer"},R=i("Signing with Externally-signed CA Certificates"),M=i("To sign generated certificates with a certificate authority (CA) generated outside of the TLS Toolkit, ensure the necessary files are in the right format and location (see "),O={href:"https://nifi.apache.org/docs/nifi-docs/html/toolkit-guide.html#additional_certificate_commands",target:"_blank",rel:"noopener noreferrer"},B=i("Additional Certificate Commands"),U=o("). For example, an organization <strong>Large Organization</strong> has an internal CA (<code>CN=ca.large.org, OU=Certificate Authority</code>). This <strong>root CA</strong> is offline and only used to sign other internal CAs. The Large IT team generates an <strong>intermediate CA</strong> (<code>CN=nifi_ca.large.org, OU=NiFi, OU=Certificate Authority</code>) to be used to sign all NiFi node certificates (<code>CN=node1.nifi.large.org, OU=NiFi</code>, <code>CN=node2.nifi.large.org, OU=NiFi</code>, etc.).",15),L=i("To use the toolkit to generate these certificates and sign them using the "),j=e("strong",null,"intermediate CA",-1),Z=i(", ensure that the following files are present (see "),J={href:"https://nifi.apache.org/docs/nifi-docs/html/toolkit-guide.html#additional_certificate_commands",target:"_blank",rel:"noopener noreferrer"},G=i("Additional Certificate Commands"),H=i("):"),V=o(`<ul><li><p><code>nifi-cert.pem</code>\u2009\u2014\u2009the public certificate of the <strong>intermediate CA</strong> in PEM format</p></li><li><p><code>nifi-key.key</code>\u2009\u2014\u2009the Base64-encoded private key of the <strong>intermediate CA</strong> in PKCS #1 PEM format</p></li></ul><p>If the <strong>intermediate CA</strong> was the <strong>root CA</strong>, it would be <strong>self-signed</strong>\u2009\u2014\u2009the signature over the certificate would be issued from the same key. In that case (the same as a toolkit-generated CA), no additional arguments are necessary. However, because the <strong>intermediate CA</strong> is signed by the <strong>root CA</strong>, the public certificate of the <strong>root CA</strong> needs to be provided as well to validate the signature. The <code>--additionalCACertificate</code> parameter is used to specify the path to the signing public certificate. The value should be the absolute path to the <strong>root CA</strong> public certificate.</p><p>Example:</p><pre># Generate cert signed by intermediate CA (which is signed by root CA) -- WILL FAIL

$ ./bin/tls-toolkit.sh standalone -n &#39;node1.nifi.apache.org&#39; \\
-P passwordpassword \\
-S passwordpassword \\
-o /opt/certs/externalCA \\
-O

2018/08/02 18:48:11 INFO [main] org.apache.nifi.toolkit.tls.standalone.TlsToolkitStandaloneCommandLine: No nifiPropertiesFile specified, using embedded one.
2018/08/02 18:48:12 INFO [main] org.apache.nifi.toolkit.tls.standalone.TlsToolkitStandalone: Running standalone certificate generation with output directory /opt/certs/externalCA
2018/08/02 18:48:12 INFO [main] org.apache.nifi.toolkit.tls.util.TlsHelper: Verifying the certificate signature for CN=nifi_ca.large.org, OU=Certificate Authority
2018/08/02 18:48:12 INFO [main] org.apache.nifi.toolkit.tls.util.TlsHelper: Attempting to verify certificate CN=nifi_ca.large.org, OU=NiFi, OU=Certificate Authority signature with CN=nifi_ca.large.org, OU=NiFi, OU=Certificate Authority
2018/08/02 18:48:12 WARN [main] org.apache.nifi.toolkit.tls.util.TlsHelper: Certificate CN=nifi_ca.large.org, OU=NiFi, OU=Certificate Authority not signed by CN=nifi_ca.large.org, OU=NiFi, OU=Certificate Authority [certificate does not verify with supplied key]
Error generating TLS configuration. (The signing certificate was not signed by any known certificates)

# Provide additional CA certificate path for signature verification of intermediate CA

$ ./bin/tls-toolkit.sh standalone -n &#39;node1.nifi.apache.org&#39; \\
-P passwordpassword \\
-S passwordpassword \\
-o /opt/certs/externalCA \\
--additionalCACertificate /opt/certs/externalCA/root.pem \\
-O

2018/08/02 18:48:44 INFO [main] org.apache.nifi.toolkit.tls.standalone.TlsToolkitStandaloneCommandLine: No nifiPropertiesFile specified, using embedded one.
2018/08/02 18:48:44 INFO [main] org.apache.nifi.toolkit.tls.standalone.TlsToolkitStandalone: Running standalone certificate generation with output directory /opt/certs/externalCA
2018/08/02 18:48:44 INFO [main] org.apache.nifi.toolkit.tls.util.TlsHelper: Verifying the certificate signature for CN=nifi_ca.large.org, OU=NiFi, OU=Certificate Authority
2018/08/02 18:48:44 INFO [main] org.apache.nifi.toolkit.tls.util.TlsHelper: Attempting to verify certificate CN=nifi_ca.large.org, OU=NiFi, OU=Certificate Authority signature with CN=ca.large.org, OU=Certificate Authority
2018/08/02 18:48:44 INFO [main] org.apache.nifi.toolkit.tls.util.TlsHelper: Certificate was signed by CN=ca.large.org, OU=Certificate Authority
2018/08/02 18:48:44 INFO [main] org.apache.nifi.toolkit.tls.standalone.TlsToolkitStandalone: Using existing CA certificate /opt/certs/externalCA/nifi-cert.pem and key /opt/certs/externalCA/nifi-key.key
2018/08/02 18:48:44 INFO [main] org.apache.nifi.toolkit.tls.standalone.TlsToolkitStandalone: Writing new ssl configuration to /opt/certs/externalCA/node1.nifi.apache.org
2018/08/02 18:48:44 INFO [main] org.apache.nifi.toolkit.tls.standalone.TlsToolkitStandalone: Successfully generated TLS configuration for node1.nifi.apache.org 1 in /opt/certs/externalCA/node1.nifi.apache.org
2018/08/02 18:48:44 INFO [main] org.apache.nifi.toolkit.tls.standalone.TlsToolkitStandalone: No clientCertDn specified, not generating any client certificates.
2018/08/02 18:48:44 INFO [main] org.apache.nifi.toolkit.tls.standalone.TlsToolkitStandalone: tls-toolkit standalone completed successfully
</pre><h3 id="\u989D\u5916\u7684\u8BC1\u4E66\u547D\u4EE4-additional-certificate-commands" tabindex="-1"><a class="header-anchor" href="#\u989D\u5916\u7684\u8BC1\u4E66\u547D\u4EE4-additional-certificate-commands" aria-hidden="true">#</a> \u989D\u5916\u7684\u8BC1\u4E66\u547D\u4EE4(Additional Certificate Commands)</h3><ol><li><p>To convert from DER encoded public certificate (<code>cert.der</code>) to PEM encoded (<code>cert.pem</code>):</p><ul><li><p>If the DER file contains both the public certificate and private key, remove the private key with this command:</p><ul><li><code>perl -pe &#39;BEGIN{undef $/;} s|-----BEGIN PRIVATE KEY-----.*?-----END PRIVATE KEY-----|Removed private key|gs&#39; cert.der &gt; cert.pem</code></li></ul></li><li><p>If the DER file only contains the public certificate, use this command:</p><ul><li><code>openssl x509 -inform der -in cert.der -out cert.pem</code></li></ul></li></ul></li><li><p>To convert from a PKCS12 keystore (<code>keystore.p12</code>) containing both the public certificate and private key into PEM encoded files (<code>$PASSWORD</code> is the keystore password):</p><ul><li><p><code>openssl pkcs12 -in keystore.p12 -nodes -clcerts -nokeys -out cert.pem -password &quot;pass:$PASSWORD&quot;</code></p></li><li><p><code>openssl pkcs12 -in keystore.p12 -nodes -nocerts -out key.key -password &quot;pass:$PASSWORD&quot;</code></p></li></ul></li><li><p>To convert from a Java Keystore (<code>keystore.jks</code>) containing private key into PEM encoded files (<code>$P12_PASSWORD</code> is the PKCS12 keystore password, <code>$JKS_PASSWORD</code> is the Java keystore password you want to set, and <code>$ALIAS</code> can be any value\u2009\u2014\u2009the NiFi default is <code>nifi-key</code>):</p><ul><li><p><code>keytool -importkeystore -srckeystore keystore.jks -destkeystore keystore.p12 -srcstoretype JKS -deststoretype PKCS12 -destkeypass &quot;$P12_PASSWORD&quot; -deststorepass &quot;$P12_PASSWORD&quot; -srcstorepass &quot;$JKS_PASSWORD&quot; -srcalias &quot;$ALIAS&quot; -destalias &quot;$ALIAS&quot;</code></p></li><li><p>Follow the steps above to convert from <code>keystore.p12</code> to <code>cert.pem</code> and <code>key.key</code></p></li></ul></li><li><p>To convert from PKCS #8 PEM format to PKCS #1 PEM format:</p><ul><li><p>If the private key is provided in PKCS #8 format (the file begins with <code>-----BEGIN PRIVATE KEY-----</code> rather than <code>-----BEGIN RSA PRIVATE KEY-----</code>), the following command will convert it to PKCS #1 format, move the original to <code>nifi-key-pkcs8.key</code>, and rename the PKCS #1 version as <code>nifi-key.key</code>:</p><ul><li><code>openssl rsa -in nifi-key.key -out nifi-key-pkcs1.key &amp;&amp; mv nifi-key.key nifi-key-pkcs8.key &amp;&amp; mv nifi-key-pkcs1.key nifi-key.key</code></li></ul></li></ul></li><li><p>To combine a private key in PEM format (<code>private.key</code>) and public certificate in PEM format (<code>certificate.pem</code>) into PKCS12 keystore:</p><ul><li><p>The following command will create the PKCS12 keystore (<code>keystore.p12</code>) from the two independent files. A Java keystore (JKS) cannot be formed directly from the PEM files:</p><ul><li><code>openssl pkcs12 -export -out keystore.p12 -inkey private.key -in certificate.pem</code></li></ul></li></ul></li><li><p>To convert a PKCS12 keystore (<code>keystore.p12</code>) to JKS keystore (<code>keystore.jks</code>):</p><ul><li><p>The following command will create the JKS keystore (<code>keystore.jks</code>). The <code>-destalias</code> flag is optional, as NiFi does not currently read from a specific alias in the keystore. The user will be prompted for a keystore password, which must be set and have minimum 8 characters, and a key password, which can be the same as the keystore password or different:</p><ul><li><code>keytool -importkeystore -srckeystore keystore.p12 -srcstoretype pkcs12 -destkeystore keystore.jks -deststoretype jks -destalias nifi-key</code></li></ul></li></ul></li></ol><h2 id="zookeeper-migrator" tabindex="-1"><a class="header-anchor" href="#zookeeper-migrator" aria-hidden="true">#</a> ZooKeeper Migrator</h2><p>You can use the <code>zk-migrator</code> tool to perform the following tasks:</p><ul><li><p>Moving ZooKeeper information from one ZooKeeper cluster to another</p></li><li><p>Migrating ZooKeeper node ownership</p></li></ul><p>For example, you may want to use the ZooKeeper Migrator when you are:</p><ul><li><p>Upgrading from NiFi 0.x to NiFi 1.x in which embedded ZooKeepers are used</p></li><li><p>Migrating from an embedded ZooKeeper in NiFi 0.x or 1.x to an external ZooKeeper</p></li><li><p>Upgrading from NiFi 0.x with an external ZooKeeper to NiFi 1.x with the same external ZooKeeper</p></li><li><p>Migrating from an external ZooKeeper to an embedded ZooKeeper in NiFi 1.x</p></li></ul>`,11),Q={id:"usage-10",tabindex:"-1"},W=e("a",{class:"header-anchor",href:"#usage-10","aria-hidden":"true"},"#",-1),Y=i(),X={href:"https://nifi.apache.org/docs/nifi-docs/html/toolkit-guide.html#usage-11",target:"_blank",rel:"noopener noreferrer"},$=i("Usage"),ee=o(`<p>The <code>zk-migrator</code> tool is invoked as <code>./bin/zk-migrator.sh</code> or <code>bin\\zk-migrator.bat</code>.</p><p>To show help:</p><pre>./bin/zk-migrator.sh -h
</pre><p>The following are available options:</p><ul><li><p><code>-a</code>,<code>--auth &lt;username:password&gt;</code> Allows the specification of a username and password for authentication with ZooKeeper. This option is mutually exclusive with the <code>-k</code>,<code>--krb-conf</code> option.</p></li><li><p><code>-f</code>,<code>--file &lt;filename&gt;</code> The file used for ZooKeeper data serialized as JSON. When used with the <code>-r</code>,<code>--receive</code> option, data read from ZooKeeper will be stored in the given filename. When used with the <code>-s</code>,<code>--send</code> option, the data in the file will be sent to ZooKeeper.</p></li><li><p><code>-h</code>,<code>--help</code> Prints help, displays available parameters with descriptions</p></li><li><p><code>--ignore-source</code> Allows the ZooKeeper Migrator to write to the ZooKeeper and path from which the data was obtained.</p></li><li><p><code>-k</code>,<code>--krb-conf &lt;jaas-filename&gt;</code> Allows the specification of a JAAS configuration file to allow authentication with a ZooKeeper configured to use Kerberos. This option is mutually exclusive with the <code>-a</code>,<code>--auth</code> option.</p></li><li><p><code>-r</code>,<code>--receive</code> Receives data from ZooKeeper and writes to the given filename (if the <code>-f</code>,<code>--file</code> option is provided) or standard output. The data received will contain the full path to each node read from ZooKeeper. This option is mutually exclusive with the <code>-s</code>,<code>--send</code> option.</p></li><li><p><code>-s</code>,<code>--send</code> Sends data to ZooKeeper that is read from the given filename (if the <code>-f</code>,<code>--file</code> option is provided) or standard input. The paths for each node in the data being sent to ZooKeeper are absolute paths, and will be stored in ZooKeeper under the <strong>path</strong> portion of the <code>-z</code>,<code>--zookeeper</code> argument. Typically, the <strong>path</strong> portion of the argument can be omitted, which will store the nodes at their absolute paths. This option is mutually exclusive with the <code>-r</code>,<code>--receive</code> option.</p></li><li><p><code>--use-existing-acl</code> Allows the Zookeeper Migrator to write ACL values retrieved from the source Zookeeper server to destination server. Default action will apply Open rights for unsecured destinations or Creator Only rights for secured destinations.</p></li><li><p><code>-z</code>,<code>--zookeeper &lt;zookeeper-endpoint&gt;</code> The ZooKeeper server(s) to use, specified by a connect string, comprised of one or more comma-separated host:port pairs followed by a path, in the format of <em>host:port[,host2:port\u2026\u200B,hostn:port]/znode/path</em>.</p></li></ul>`,5),ie={id:"migrating-between-source-and-destination-zookeepers",tabindex:"-1"},te=e("a",{class:"header-anchor",href:"#migrating-between-source-and-destination-zookeepers","aria-hidden":"true"},"#",-1),ne=i(),oe={href:"https://nifi.apache.org/docs/nifi-docs/html/toolkit-guide.html#migrating-between-source-and-destination-zookeepers",target:"_blank",rel:"noopener noreferrer"},ae=i("Migrating Between Source and Destination ZooKeepers"),se=e("p",null,"Before you begin, confirm that:",-1),re=e("li",null,[e("p",null,"You have installed the destination ZooKeeper cluster.")],-1),de=e("li",null,[e("p",null,"You have installed and configured a NiFi cluster to use the destination ZooKeeper cluster.")],-1),ce=e("li",null,[e("p",null,"If you are migrating ZooKeepers due to upgrading NiFi from 0.x to 1.x,, you have already followed appropriate NiFi upgrade steps.")],-1),le=e("li",null,[e("p",null,"You have configured Kerberos as needed.")],-1),pe=e("li",null,[e("p",null,"You have not started processing any dataflow (to avoid duplicate data processing).")],-1),ue=i("If one of the ZooKeeper clusters you are using is configured with Kerberos, you are running the ZooKeeper Migrator from a host that has access to NiFi\u2019s ZooKeeper client jaas configuration file (see the "),he={href:"https://nifi.apache.org/docs/nifi-docs/html/administration-guide.html#zk_kerberos_client",target:"_blank",rel:"noopener noreferrer"},fe=i("Kerberizing NiFi\u2019s ZooKeeper Client"),me=i(" section in the System Administrator\u2019s Guide for more information)."),ge={id:"zookeeper-migration-steps",tabindex:"-1"},ve=e("a",{class:"header-anchor",href:"#zookeeper-migration-steps","aria-hidden":"true"},"#",-1),be=i(),ye={href:"https://nifi.apache.org/docs/nifi-docs/html/toolkit-guide.html#zookeeper-migration-steps",target:"_blank",rel:"noopener noreferrer"},ke=i("ZooKeeper Migration Steps"),we=o('<ol><li>Collect the following information:</li></ol><table><thead><tr><th>col 1</th><th>col 2</th></tr></thead><tbody><tr><td><strong>Required Information</strong></td><td><strong>Description</strong></td></tr><tr><td>Source ZooKeeper hostname (<strong>sourceHostname</strong>)</td><td>The hostname must be one of the hosts running in the ZooKeeper ensemble, which can be found in <code>NiFi installation dir</code>/conf/zookeeper.properties . Any of the hostnames declared in the <code>server.N</code> properties can be used.</td></tr><tr><td>Destination ZooKeeper hostname (<strong>destinationHostname</strong>)</td><td>The hostname must be one of the hosts running in the ZooKeeper ensemble, which can be found in <code>NiFi installation dir</code>/conf/zookeeper.properties. Any of the hostnames declared in the <code>server.N</code> properties can be used.</td></tr><tr><td>Source ZooKeeper port (<strong>sourceClientPort</strong>)</td><td>This can be found in <code>NiFi installation dir</code>/conf/zookeeper.properties. The port is specified in the <code>clientPort</code> property or at the end of the server string.</td></tr><tr><td>Destination ZooKeeper port (<strong>destinationClientPort</strong>)</td><td>This can be found in <code>NiFi installation dir</code>/conf/zookeeper.properties_. The port is specified in the <code>clientPort</code> property or at the end of the server string.</td></tr><tr><td>Export data path</td><td>Determine the path that will store a json file containing the export of data from ZooKeeper. It must be readable and writable by the user running the zk-migrator tool.</td></tr><tr><td>Source ZooKeeper Authentication Information</td><td>This information is in <code>NiFi installation dir</code>/conf/state-management.xml_. For NiFi 0.x, if Creator Only is specified in <em>state-management.xml</em>, you need to supply authentication information using the <code>-a,--auth</code> argument with the values from the Username and Password properties in <em>state-management.xml</em>. For NiFi 1.x, supply authentication information using the <code>-k,--krb-conf</code> argument.</td></tr></tbody></table><p>| If the <em>state-management.xml</em> specifies Open, no authentication is required. | | Destination ZooKeeper Authentication Information | This information is in <code>NiFi installation dir</code>/conf/state-management.xml_. For NiFi 0.x, if Creator Only is specified in <em>state-management.xml</em>, you need to supply authentication information using the <code>-a,--auth</code> argument with the values from the Username and Password properties in state-management.xml. For NiFi 1.x, supply authentication information using the <code>-k,--krb-conf</code> argument. |</p><p>| If the <em>state-management.xml</em> specifies Open, no authentication is required. | | Root path to which NiFi writes data in Source ZooKeeper (<strong>sourceRootPath</strong>) | This information can be found in <code>&lt;NiFi installation dir&gt;/conf/state-management.xml</code> under the Root Node property in the cluster-provider element. (default: <code>/nifi</code>) | | Root path to which NiFi writes data in Destination ZooKeeper (<strong>destinationRootPath</strong>) | This information can be found in <code>NiFi installation dir</code>/conf/state-management.xml_ under the Root Node property in the cluster-provider element. |</p><table><thead><tr><th>col 1</th><th>col 2</th></tr></thead><tbody><tr><td>__</td><td>As of NiFi 1.10.x, because of an upgrade to ZooKeeper 3.5.x, the migrator may have a permission error <code>&quot;NoAuthException: KeeperErrorCode = NoAuth for /zookeeper/config&quot;</code> when attempting to use <code>/</code> as the destination root path. This is because the <code>/zookeeper/config</code> znode has read-only permissions. Instead use a destination path of <code>/nifi/components</code> or similar.</td></tr></tbody></table><ol start="2"><li><p>Stop all processors in the NiFi flow. If you are migrating between two NiFi installations, the flows on both must be stopped.</p></li><li><p>Export the NiFi component data from the source ZooKeeper. The following command reads from the specified ZooKeeper running on the given hostname:port, using the provided path to the data, and authenticates with ZooKeeper using the given username and password. The data read from ZooKeeper is written to the file provided.</p><ul><li><p>For NiFi 0.x</p><ul><li><p>For an open ZooKeeper:</p><ul><li><code>zk-migrator.sh -r -z sourceHostname:sourceClientPort/sourceRootPath/components -f /path/to/export/zk-source-data.json</code></li></ul></li><li><p>For a ZooKeeper using username:password for authentication:</p><ul><li><code>zk-migrator.sh -r -z sourceHostname:sourceClientPort/sourceRootPath/components -a &lt;username:password&gt; -f /path/to/export/zk-source-data.json</code></li></ul></li></ul></li><li><p>For NiFi 1.x</p><ul><li><p>For an open ZooKeeper:</p><ul><li><code>zk-migrator.sh -r -z sourceHostname:sourceClientPort/sourceRootPath/components -f /path/to/export/zk-source-data.json</code></li></ul></li><li><p>For a ZooKeeper using Kerberos for authentication:</p><ul><li><code>zk-migrator.sh -r -z sourceHostname:sourceClientPort/sourceRootPath/components -k /path/to/jaasconfig/jaas-config.conf -f /path/to/export/zk-source-data.json</code></li></ul></li></ul></li></ul></li><li><p>(Optional) If you have used the new NiFi installation to do any processing, you can also export its ZooKeeper data as a backup prior to performing the migration.</p><ul><li><p>For an open ZooKeeper:</p><ul><li><code>zk-migrator.sh -r -z destinationHostname:destinationClientPort/destinationRootPath/components -f /path/to/export/zk-destination-backup-data.json</code></li></ul></li><li><p>For a ZooKeeper using Kerberos for authentication:</p><ul><li><code>zk-migrator.sh -r -z destinationHostname:destinationClientPort/destinationRootPath/components -k /path/to/jaasconfig/jaas-config.conf -f /path/to/export/zk-destination-backup-data.json</code></li></ul></li></ul></li><li><p>Migrate the ZooKeeper data to the destination ZooKeeper. If the source and destination ZooKeepers are the same, the <code>--ignore-source</code> option can be added to the following examples.</p><ul><li><p>For an open ZooKeeper:</p><ul><li><code>zk-migrator.sh -s -z destinationHostname:destinationClientPort/destinationRootPath/components -f /path/to/export/zk-source-data.json</code></li></ul></li><li><p>For a ZooKeeper using Kerberos for authentication:</p><ul><li><code>zk-migrator.sh -s -z destinationHostname:destinationClientPort/destinationRootPath/components -k /path/to/jaasconfig/jaas-config.conf -f /path/to/export/zk-source-data.json</code></li></ul></li></ul></li><li><p>Once the migration has completed successfully, start the processors in the NiFi flow. Processing should continue from the point at which it was stopped when the NiFi flow was stopped.</p></li></ol>',6);function xe(Ae,Ne){const t=s("ExternalLinkIcon");return r(),d("div",null,[l,e("p",null,[p,e("a",u,[h,n(t)]),f]),m,e("p",null,[g,e("a",v,[b,n(t)]),y]),k,e("h4",w,[x,A,e("a",N,[n(t)]),C]),F,e("h4",S,[T,P,e("a",_,[n(t)]),I]),q,e("h4",E,[K,z,e("a",D,[n(t)]),R]),e("p",null,[M,e("a",O,[B,n(t)]),U]),e("p",null,[L,j,Z,e("a",J,[G,n(t)]),H]),V,e("h3",Q,[W,Y,e("a",X,[n(t)]),$]),ee,e("h3",ie,[te,ne,e("a",oe,[n(t)]),ae]),se,e("ul",null,[re,de,ce,le,pe,e("li",null,[e("p",null,[ue,e("a",he,[fe,n(t)]),me])])]),e("h4",ge,[ve,be,e("a",ye,[n(t)]),ke]),we])}var Fe=a(c,[["render",xe],["__file","7-ToolkitGuide.html.vue"]]);export{Fe as default};
